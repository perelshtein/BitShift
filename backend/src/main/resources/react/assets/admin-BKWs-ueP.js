import{u as J,j as e,R as M,N as be,O as st,r as s,C as se,S as ue,A as V,L as ie,B as A,U as Q,a as he,b as le,c as $,d as ae,e as nt,f as me,P as H,g as at,o as je,h as Te,p as Xe,i as Se,k as it,l as lt,m as He,n as we}from"./index-CLB7HOer.js";const rt="_sidebar_1e3pw_4",ct="_loading_1e3pw_57",ot="_searchSpinner_1e3pw_61",dt="_spin_1e3pw_1",ut="_active_1e3pw_81",ht="_pending_1e3pw_124",xt="_nested_1e3pw_128",jt="_show_1e3pw_134",mt="_hide_1e3pw_146",ft="_detail_1e3pw_163",gt="_horzList_1e3pw_199",pt="_oneLine_1e3pw_212",Ct="_withMargin_1e3pw_212",vt="_selectedOrders_1e3pw_224",yt="_tableSevenCol_1e3pw_234",bt="_tableSixCol_1e3pw_235",St="_tableFiveCol_1e3pw_236",_t="_tableFourCol_1e3pw_237",Tt="_tableThreeCol_1e3pw_238",wt="_tableTwoCol_1e3pw_239",Nt="_container_1e3pw_269",Ft="_tableTwoColLayout_1e3pw_282",Et="_tableOrders_1e3pw_289",kt="_editUser_1e3pw_295",It="_editTimetable_1e3pw_299",Ot="_checkboxList_1e3pw_307",Rt="_tableBidLayout_1e3pw_318",Lt="_labelBid_1e3pw_352",Pt="_tableBidBottom_1e3pw_370",Ut="_checkboxContainer_1e3pw_410",Mt="_links_1e3pw_427",Dt="_reserveColumn_1e3pw_448",$t="_addButton_1e3pw_455",At="_actionButtons_1e3pw_460",Bt="_save_1e3pw_472",zt="_spanTwoColumns_1e3pw_477",Gt="_spanFourColumns_1e3pw_481",Vt="_rolesList_1e3pw_489",Wt="_status_1e3pw_493",Kt="_tooltipContainer_1e3pw_498",Yt="_tooltipText_1e3pw_508",Qt="_validationWarning_1e3pw_530",Xt="_pagination_1e3pw_536",i={sidebar:rt,loading:ct,searchSpinner:ot,spin:dt,active:ut,pending:ht,nested:xt,show:jt,hide:mt,detail:ft,"direction-filter":"_direction-filter_1e3pw_182","course-filter":"_course-filter_1e3pw_183","notify-filter":"_notify-filter_1e3pw_184","order-filter":"_order-filter_1e3pw_188",horzList:gt,oneLine:pt,withMargin:Ct,selectedOrders:vt,tableSevenCol:yt,tableSixCol:bt,tableFiveCol:St,tableFourCol:_t,tableThreeCol:Tt,tableTwoCol:wt,container:Nt,tableTwoColLayout:Ft,tableOrders:Et,editUser:kt,editTimetable:It,checkboxList:Ot,tableBidLayout:Rt,labelBid:Lt,tableBidBottom:Pt,checkboxContainer:Ut,links:Mt,reserveColumn:Dt,addButton:$t,actionButtons:At,save:Bt,spanTwoColumns:zt,spanFourColumns:Gt,rolesList:Vt,status:Wt,tooltipContainer:Kt,tooltipText:Yt,validationWarning:Qt,pagination:Xt,"order-new":"_order-new_1e3pw_545","order-waitingForPayment":"_order-waitingForPayment_1e3pw_556","order-waitingForConfirmation":"_order-waitingForConfirmation_1e3pw_557","order-payed":"_order-payed_1e3pw_558","order-waitingForPayout":"_order-waitingForPayout_1e3pw_559","order-onCheck":"_order-onCheck_1e3pw_560","order-completed":"_order-completed_1e3pw_571","order-deleted":"_order-deleted_1e3pw_582","order-cancelled":"_order-cancelled_1e3pw_583","order-error":"_order-error_1e3pw_584"};function Ht(){const t=J(),n=![M.LOGIN,M.LOGOUT].includes(location.pathname),a=c=>{c.preventDefault(),window.history.length>1?t(-1):t(M.WEBSITE)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:i.sidebar,children:[e.jsxs("h1",{children:[e.jsx("img",{src:"/coin.svg"}),"Обменник"]}),e.jsx("nav",{children:e.jsxs("ul",{children:[e.jsx("li",{children:e.jsx(xe,{title:"Валюты",child:[{route:M.CURRENCIES,name:"Валюты"},{route:M.CURRENCY_FIELDS,name:"Поля валют"}]})}),e.jsx("li",{children:e.jsx(xe,{title:"Курсы",child:[{route:M.COURSES,name:"Список курсов"},{route:M.OPTIONS_BYBIT,name:"Bybit"},{route:M.OPTIONS_BINANCE,name:"Binance"},{route:M.OPTIONS_COINMARKETCAP,name:"CoinMarketCap"},{route:M.OPTIONS_CBR,name:"Центробанк"},{route:M.OPTIONS_MEXC,name:"Mexc"}]})}),e.jsx("li",{children:e.jsx(xe,{title:"Направления",child:[{route:M.FORMULAS,name:"Формулы"},{route:M.ORDER_STATUS,name:"Статусы заявок"},{route:M.DIRECTIONS,name:"Направления"}]})}),e.jsx("li",{children:e.jsx(be,{to:M.ORDERS,children:"Заявки"})}),e.jsx("li",{children:e.jsx(be,{to:M.OPTIONS,children:"Настройки"})}),e.jsx("li",{children:e.jsx(xe,{title:"Бонусы",child:[{route:M.BONUS_USERS,name:"Для пользователей"},{route:M.BONUS_USER_ORDERS,name:"Для пользователей (заявки)"},{route:M.BONUS_REFERRALS,name:"Для рефералов"},{route:M.BONUS_REFERRAL_ORDERS,name:"Для рефералов (заявки)"}]})}),e.jsx("li",{children:e.jsx(xe,{title:"Уведомления",child:[{route:M.NOTIFY_ADMIN,name:"Админу"},{route:M.NOTIFY_USER,name:"Пользователям"}]})}),e.jsx("li",{children:e.jsx(xe,{title:"Пользователи",child:[{route:M.USERS,name:"Пользователи"},{route:M.ROLES,name:"Роли"}]})}),e.jsx("li",{children:e.jsx(xe,{title:"Отзывы",child:[{route:M.STOP_WORDS,name:"Стоп-слова"},{route:M.REVIEWS,name:"Список отзывов"}]})}),e.jsx("li",{children:e.jsx(be,{to:M.NEWS,children:"Новости"})})]})})]}),e.jsxs("div",{className:i.detail,children:[n&&e.jsxs(e.Fragment,{children:[e.jsx("a",{href:"#",onClick:a,children:"Назад"}),"   |   "]}),e.jsx("a",{href:M.LOGOUT,children:"Выход"}),e.jsx(st,{})]})]})}function xe({title:t,child:n}){const[a,c]=s.useState(!1),r=()=>{c(!a)};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:a?i.show:i.hide,onClick:r,children:t}),e.jsx("ul",{className:i.nested,children:n.map((u,h)=>e.jsx("li",{children:e.jsx(be,{to:u.route,children:u.name})},h))})]})}const Sn=Object.freeze(Object.defineProperty({__proto__:null,default:Ht},Symbol.toStringTag,{value:"Module"})),Zt=({data:t,rowsSelected:n,setRowsSelected:a,activeRole:c,reserves:r,setSaving:u})=>{const h=n.includes(t.id),l=()=>{a(h?n.filter(C=>C!==t.id):[...n,t.id])},j=r[t.code],p={error:"Ошибка",off:"Отключен",manual:"Задан вручную",fromFile:"Из файла",fromExchange:"С биржи"},{reloadReserve:b}=s.useContext(V),d=async()=>{try{u(!0);let C=await b({baseCurrency:t.code});A.info(C.message)}finally{u(!1)}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:i.checkboxContainer,children:[e.jsx("input",{type:"checkbox",id:t.id,checked:h,onChange:l}),e.jsxs("span",{children:[e.jsx("label",{htmlFor:t.id,children:t.name}),e.jsx(ie,{className:i.links,to:`${M.EDIT_CURRENCY}/${t.id}`,children:c.isEditCurrency?"Редактировать..":"Просмотреть.."})]})]}),e.jsx("div",{children:t.code}),e.jsx("div",{children:t.xmlCode}),e.jsx("div",{children:p[j==null?void 0:j.reserveType]||"Отключен"}),e.jsxs("div",{className:i.reserveColumn,children:[j==null?void 0:j.value," ",j==null?void 0:j.reserveCurrency,c.isEditReserve&&(j==null?void 0:j.reserveType)=="fromFile"&&e.jsx(ie,{className:i.links,onClick:d,children:"Обновить"})]}),e.jsx("div",{children:t.isEnabled?"Активна":"Отключена"})]})},Jt=({rowsSelected:t,setRowsSelected:n,activeRole:a,reserves:c,setSaving:r})=>{let{currencies:u}=s.useContext(se);return e.jsxs("div",{className:i.tableSixCol,children:[e.jsx("div",{children:"Название"}),e.jsx("div",{children:"Код валюты"}),e.jsx("div",{children:"XML-код"}),e.jsx("div",{children:"Источник резерва"}),e.jsx("div",{children:"Резерв"}),e.jsx("div",{children:"Статус"}),u.map((h,l)=>e.jsx(Zt,{data:h,rowsSelected:t,setRowsSelected:n,activeRole:a,reserves:c,setSaving:r},l)),e.jsx(ue,{items:u,rowsSelected:t,setRowsSelected:n})]})};function qt(){const[t,n]=s.useState([]),[a,c]=s.useState(!1),[r,u]=s.useState(!0),[h,l]=s.useState([]),j=J(),{activeRole:p,loading:b}=s.useContext(Q),{deleteCurrencies:d,sendCurrency:C}=s.useContext(V),{currencies:o,setCurrencies:m}=s.useContext(se),{fetchReserves:I}=s.useContext(he),w=async f=>{try{c(!0);let v=[...o];const k=t.map(async y=>{const T=o.find(R=>R.id==y);if(T){const R={...T,isEnabled:f};return await C({currency:R}),v=v.map(F=>F.id===y?R:F),T.name}return null}),N=(await Promise.all(k)).filter(Boolean);n([]),m(v),A(`Валюты ${f?"включены":"отключены"}: ${N}`)}finally{c(!1)}},_=async()=>{try{c(!0);const f=await d({ids:t});m([...o.filter(v=>!t.includes(v.id))]),n([]),A.info(f.message)}finally{c(!1)}},S=()=>e.jsxs("div",{className:i.actionButtons,children:[e.jsxs("p",{children:["Выбрано ",t.length," элементов."]}),e.jsx("button",{onClick:()=>w(!0),children:"Активировать"}),e.jsx("button",{onClick:()=>w(!1),children:"Деактивировать"}),e.jsx("button",{onClick:_,children:"Удалить"})]});return s.useEffect(()=>{a||(async()=>{try{u(!0);const v=(await I()).data;l(v)}finally{u(!1)}})()},[o,a]),a?e.jsx("p",{children:"Сохранение..."}):r||b||!p?e.jsx("p",{children:"Загрузка..."}):e.jsxs(e.Fragment,{children:[e.jsx("h2",{children:"Список валют"}),p.isEditCurrency&&e.jsx("button",{className:i.addButton,onClick:()=>{j(M.EDIT_CURRENCY)},children:"Добавить.."}),e.jsx(Jt,{rowsSelected:t,setRowsSelected:n,activeRole:p,reserves:h,setSaving:c}),t.length>0&&e.jsx(S,{})]})}const _n=Object.freeze(Object.defineProperty({__proto__:null,default:qt},Symbol.toStringTag,{value:"Module"}));function We({message:t,obj:n,currencyCode:a}){return(n==null?void 0:n.fixedFee)>0||(n==null?void 0:n.percentageFee)>0?e.jsxs(e.Fragment,{children:[t,": ",e.jsxs("div",{className:i.horzList,children:[(n==null?void 0:n.fixedFee)>0&&e.jsxs("div",{children:[n.fixedFee," ",a]}),(n==null?void 0:n.percentageFee)>0&&e.jsxs("div",{children:[n.percentageFee," %"]})]})]}):null}function Ke({message:t,obj:n,currencyCode:a}){return(n==null?void 0:n.minAmount)>0||(n==null?void 0:n.maxAmount)>0?e.jsxs(e.Fragment,{children:[t,": ",e.jsxs("div",{className:i.horzList,children:[(n==null?void 0:n.minAmount)>0&&e.jsxs("div",{children:["Мин: ",n.minAmount," ",a," "]}),(n==null?void 0:n.maxAmount)>0&&e.jsxs("div",{children:["Макс: ",n.maxAmount," ",a]})]})]}):null}function es(){var Oe,Re,Le,Pe,Ue,Me,De,$e,Ae,Be,ze,Ge,Ve;const{id:t}=le(),{currencies:n,setCurrencies:a,currencyFields:c,loading:r}=s.useContext(se),{fetchFieldsForCurrency:u,fetchReserve:h}=s.useContext(he),{sendCurrency:l,sendFieldsForCurrency:j,sendReserve:p,reloadReserve:b,fetchCurrencyValidators:d,fetchPayin:C,fetchPayout:o}=s.useContext(V),{activeRole:m,loading:I}=s.useContext(Q),w=Array.from(new Set(n.map(O=>O.code))),_=J(),[S,f]=s.useState(!1),[v,k]=s.useState(!!t),[N,E]=s.useState(),[y,T]=s.useState(),[R,F]=s.useState([]),[L,P]=s.useState({}),[g,D]=s.useState({}),[W,B]=s.useState([]),[q,K]=s.useState([]),[X,Y]=s.useState("give"),[x,z]=s.useState({name:"",code:"",xmlCode:"",fidelity:2,isEnabled:!0,acctValidator:"AUTO",acctChain:"AUTO"}),[U,Z]=s.useState({reserveType:"off"}),[ce,re]=s.useState(null),fe=[{name:"Вручную",id:"manual"},{name:"Bybit",id:"bybit"},{name:"Mexc",id:"mexc"}],Je=["Bybit","Mexc"];s.useEffect(()=>{const O=async()=>{try{k(!0);const[G,ee,ne,de]=await Promise.all([u({id:t}).then(te=>te.data),h({code:x.code}).then(te=>te.data),x.payin=="manual"?Promise.resolve(null):C({exchange:x.payin}).then(te=>te.data),x.payout=="manual"?Promise.resolve(null):o({exchange:x.payout}).then(te=>te.data)]);B(G.give),K(G.get),Z(ee),E(ee.value),P(ne),D(de)}finally{k(!1)}};t&&x.code.trim().length>0&&!S&&O()},[t,x.payin,x.payout,S]),s.useEffect(()=>{var G;const O=n.find(ee=>ee.id==t);O&&z({...O,acctValidator:((G=O.acctValidator)==null?void 0:G.length)===0?"OFF":O.acctValidator})},[r]),s.useEffect(()=>{(async()=>{const G=await d();F(G.data)})()},[]);const Ce=O=>{const{name:G,type:ee,checked:ne,value:de}=O.target;z(te=>({...te,[G]:ee==="checkbox"?ne:de}))},qe=async({code:O})=>{try{f(!0);const G=await b({baseCurrency:O});A.info(G.data)}finally{f(!1)}},et=async()=>{var O,G,ee,ne;try{f(!0);const de={...x,acctValidator:x.acctValidator==="OFF"?"":x.acctValidator,...parseInt(t)?{id:parseInt(t)}:{},payinChain:x.payin==="manual"?"":x.payinChain||((G=(O=L[x.payin])==null?void 0:O.chains[0])==null?void 0:G.code),payoutChain:x.payout==="manual"?"":x.payoutChain||((ne=(ee=g[x.payout])==null?void 0:ee.chains[0])==null?void 0:ne.code)},te=await l({currency:de});de.id=te.data.id,a(_e=>_e.some(ve=>ve.id===te.data.id)?_e.map(ve=>ve.id===te.data.id?{...ve,...de}:ve):[..._e,de]),await j({id:te.data.id,giveFields:W,getFields:q}),m.isEditReserve&&await p({baseCurrency:x.code,reserve:{...U,value:N,reserveCurrency:U.reserveType==="fromExchange"?"USDT":U.reserveCurrency,exchangeName:U.reserveType==="fromExchange"?U.exchangeName:""}}),A.info(te.message),_(M.CURRENCIES)}finally{f(!1)}},ye=s.useMemo(()=>{var O;return L&&x.payin&&x.payin!=="manual"&&((O=L[x.payinCode])!=null&&O.chains)&&L[x.payinCode].chains.find(G=>G.code===x.payinChain)||null},[L,x.payin,x.payinChain]),Fe=s.useMemo(()=>{var O;return g&&x.payout&&x.payout!=="manual"&&((O=g[x.payoutCode])!=null&&O.chains)&&g[x.payoutCode].chains.find(G=>G.code===x.payoutChain)||null},[g,x.payout,x.payoutChain]);if(S)return e.jsx("p",{children:"Сохранение..."});if(v||I||r||!R)return e.jsx("p",{children:"Загрузка..."});const Ee={CARD:"Карта",AUTO:"Авто"},ke={AUTO:"Авто",CARDLUNA:"Visa, MasterCard, Мир"},tt=m.isEditCurrency?"Редактировать":"Просмотреть",Ie=[{id:"off",name:"Отключить"},{id:"fromFile",name:"Из файла"},{id:"fromExchange",name:"С биржи"},{id:"manual",name:"Задать вручную"}];return e.jsxs("div",{id:"edit-currency",children:[t?e.jsxs("h2",{children:[tt," валюту - ",x.name]}):e.jsx("h2",{children:"Создать валюту"}),e.jsxs("div",{className:i.tableTwoColLayout,style:{marginBottom:"1em"},children:["Название: ",e.jsx("input",{name:"name",value:x.name,onChange:Ce}),"Код: ",e.jsx("input",{name:"code",value:x.code,onChange:Ce,style:{width:"50%"}}),"XML-код: ",e.jsx("input",{name:"xmlCode",value:x.xmlCode,onChange:Ce,style:{width:"50%"}}),"Точность:",e.jsxs("div",{className:i.horzList,children:[e.jsx("input",{name:"fidelity",value:x.fidelity,onChange:Ce,type:"number",style:{width:"10em"}})," знаков после запятой"]}),m.isEditCurrency?e.jsxs(e.Fragment,{children:["Прием:",e.jsxs("div",{className:i.horzList,children:[e.jsx($,{rows:fe,name:"payin",selectedId:x==null?void 0:x.payin,setSelectedId:O=>z({...x,payin:O})}),x.payin!=="manual"&&L&&e.jsx($,{rows:Object.entries(L).map(([O,G])=>({id:O,name:(G==null?void 0:G.name)||O})),name:"payinCode",selectedId:x==null?void 0:x.payinCode,setSelectedId:O=>{var G,ee,ne;return z({...x,payinCode:O,payinChain:((ne=(ee=(G=L[O])==null?void 0:G.chains)==null?void 0:ee.at(0))==null?void 0:ne.code)||""})}}),x.payin!=="manual"&&L&&(x==null?void 0:x.payinCode)&&((Oe=L[x.payinCode])==null?void 0:Oe.chains)&&e.jsxs(e.Fragment,{children:["Сеть:",e.jsx($,{rows:L[x.payinCode].chains.map(O=>({id:O.code,name:O.name||O.code})),name:"payinChain",selectedId:x==null?void 0:x.payinChain,setSelectedId:O=>z({...x,payinChain:O})})]})]})]}):e.jsxs(e.Fragment,{children:["Прием:",e.jsxs("div",{className:i.horzList,children:[(x==null?void 0:x.payin)=="manual"?"Вручную":e.jsxs(e.Fragment,{children:["currencyData?.payin",e.jsx("div",{children:((Re=L[x==null?void 0:x.payinCode])==null?void 0:Re.name)||((Le=L[x==null?void 0:x.payinCode])==null?void 0:Le.code)||"Ошибка"})]}),(x==null?void 0:x.payinChain)&&e.jsxs(e.Fragment,{children:["Сеть:",((Me=(Ue=(Pe=L[x==null?void 0:x.payinCode])==null?void 0:Pe.chains)==null?void 0:Ue.find(O=>O.code===x.payinChain))==null?void 0:Me.name)||x.payinChain]})]})]}),e.jsx(We,{message:"Комиссия на прием",obj:ye,currencyCode:x.payinCode}),e.jsx(Ke,{message:"Лимиты на прием",obj:ye,currencyCode:x.payinCode}),ye&&e.jsxs(e.Fragment,{children:["Количество подтверждений: ",e.jsx("span",{children:ye.confirmation})]}),m.isEditCurrency?e.jsxs(e.Fragment,{children:["Отправка:",e.jsxs("div",{className:i.horzList,children:[e.jsx($,{rows:fe,name:"payout",selectedId:x==null?void 0:x.payout,setSelectedId:O=>z({...x,payout:O})}),x.payout!=="manual"&&g&&e.jsx($,{rows:Object.entries(g).map(([O,G])=>({id:O,name:(G==null?void 0:G.name)||O})),name:"payoutCode",selectedId:x==null?void 0:x.payoutCode,setSelectedId:O=>{var G,ee,ne;return z({...x,payoutCode:O,payoutChain:((ne=(ee=(G=g[O])==null?void 0:G.chains)==null?void 0:ee.at(0))==null?void 0:ne.code)||""})}}),x.payout!=="manual"&&g&&(x==null?void 0:x.payoutCode)&&((De=g[x.payoutCode])==null?void 0:De.chains)&&e.jsxs(e.Fragment,{children:["Сеть:",e.jsx($,{rows:g[x.payoutCode].chains.map(O=>({id:O.code,name:O.name||O.code})),name:"payoutChain",selectedId:x==null?void 0:x.payoutChain,setSelectedId:O=>z({...x,payoutChain:O})})]})]})]}):e.jsxs(e.Fragment,{children:["Прием:",e.jsxs("div",{className:i.horzList,children:[(x==null?void 0:x.payout)=="manual"?"Вручную":e.jsxs(e.Fragment,{children:["currencyData?.payout",e.jsx("div",{children:(($e=g[x==null?void 0:x.payoutCode])==null?void 0:$e.name)||((Ae=g[x==null?void 0:x.payoutCode])==null?void 0:Ae.code)||"Ошибка"})]}),(x==null?void 0:x.payoutChain)&&e.jsxs(e.Fragment,{children:["Сеть:",((Ge=(ze=(Be=g[x==null?void 0:x.payoutCode])==null?void 0:Be.chains)==null?void 0:ze.find(O=>O.code===x.payoutChain))==null?void 0:Ge.name)||x.payoutChain]})]})]}),e.jsx(We,{message:"Комиссия на отправку",obj:Fe,currencyCode:x.payoutCode}),e.jsx(Ke,{message:"Лимиты на отправку",obj:Fe,currencyCode:x.payoutCode}),"Резерв:",m.isEditReserve?e.jsxs("div",{className:i.horzList,children:[e.jsx($,{rows:Ie,selectedId:U==null?void 0:U.reserveType,setSelectedId:O=>Z({...U,reserveType:O})}),(U==null?void 0:U.reserveType)==="manual"&&e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"number",style:{width:"10em"},value:N,onChange:O=>E(parseFloat(O.target.value))}),e.jsx($,{rows:w,selectedId:U==null?void 0:U.reserveCurrency,setSelectedId:O=>Z({...U,reserveCurrency:O})})]}),(U==null?void 0:U.reserveType)==="fromExchange"&&e.jsx($,{rows:Je,selectedId:U==null?void 0:U.exchangeName,setSelectedId:O=>Z({...U,exchangeName:O})}),((U==null?void 0:U.reserveType)==="fromFile"||(U==null?void 0:U.reserveType)==="fromExchange")&&e.jsxs(e.Fragment,{children:[U.value," ",U.reserveCurrency]}),(U==null?void 0:U.reserveType)==="fromFile"&&e.jsx(ie,{className:i.links,onClick:()=>qe({code:x.code}),children:"Обновить"}),U==null&&"Ошибка загрузки резерва!"]}):e.jsxs("div",{className:i.horzList,children:[((Ve=Ie.find(O=>O.id===(U==null?void 0:U.reserveType)))==null?void 0:Ve.name)||"Отключен",(U==null?void 0:U.reserveType)!=="off"&&e.jsxs(e.Fragment,{children:[", ",U.value," ",U.reserveCurrency]})]}),e.jsxs("label",{className:[i.spanTwoColumns,i.oneLine].join(" "),children:[e.jsx("input",{type:"checkbox",name:"isEnabled",checked:x.isEnabled,onChange:Ce}),"Активная валюта"]}),"Валидатор счета:",e.jsxs("div",{className:i.horzList,children:[e.jsx($,{rows:Object.keys(R).map(O=>Ee[O]?{id:O,name:Ee[O]}:O).concat({id:"OFF",name:"Отключить"}),selectedId:x.acctValidator,setSelectedId:O=>z({...x,acctValidator:O})}),R[x.acctValidator]&&e.jsxs(e.Fragment,{children:["Сеть:",e.jsx($,{rows:[{id:"",name:"Выберите.."},...R[x.acctValidator].map(O=>ke[O]?{id:O,name:ke[O]}:O)],selectedId:x.acctChain,setSelectedId:O=>z({...x,acctChain:O})})]})]}),"Поля:",e.jsxs("div",{className:i.horzList,children:[e.jsx($,{rows:[{id:"give",name:"Отдаю"},{id:"get",name:"Получаю"}],selectedId:X,setSelectedId:Y}),e.jsx("button",{onClick:()=>_(M.EDIT_CURRENCY_FIELD),children:"Добавить поле.."})]})]}),X==="give"&&e.jsx(ae,{rows:c,checkedKeys:W,onCheckChange:B,className:i.checkboxList}),X==="get"&&e.jsx(ae,{rows:c,checkedKeys:q,onCheckChange:K,className:i.checkboxList}),e.jsx("h3",{children:"Проверить адрес:"}),e.jsx(nt,{currencyId:t,chain:x==null?void 0:x.acctChain,wallet:y,setWallet:T,result:ce,setResult:re}),e.jsx("div",{className:i.actionButtons,style:{marginTop:"1em"},children:m.isEditCurrency&&e.jsx("button",{className:i.save,onClick:et,children:"Сохранить"})})]})}const Tn=Object.freeze(Object.defineProperty({__proto__:null,default:es},Symbol.toStringTag,{value:"Module"})),ts=({data:t,rowsSelected:n,setRowsSelected:a})=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:i.checkboxContainer,children:[e.jsx("input",{type:"checkbox",id:t.id,checked:n.includes(t.id),onChange:()=>{n.includes(t.id)?a(n.filter(c=>c!==t.id)):a([...n,t.id])}}),e.jsxs("span",{children:[e.jsx("label",{htmlFor:t.id,children:t.name}),e.jsx(ie,{className:i.links,to:`${M.EDIT_CURRENCY_FIELD}/${t.id}`,children:"Редактировать.."})]})]}),e.jsx("div",{children:t.status})]}),ss=({data:t,rowsSelected:n,setRowsSelected:a})=>e.jsxs("div",{className:i.tableTwoCol,children:[e.jsx("div",{children:"Название"}),e.jsx("div",{children:"Статус"}),t.map((c,r)=>e.jsx(ts,{data:c,rowsSelected:n,setRowsSelected:a},r)),e.jsx(ue,{items:t,rowsSelected:n,setRowsSelected:a})]});function ns(){const[t,n]=s.useState([]),[a,c]=s.useState(!1),r=J(),{activeRole:u}=s.useContext(Q),{currencyFields:h,setCurrencyFields:l,loading:j}=s.useContext(se),{deleteCurrencyFields:p}=s.useContext(V),b=({rowsSelected:C})=>e.jsxs("div",{className:i.actionButtons,children:[e.jsxs("p",{children:["Выбрано ",C.length," элементов."]}),e.jsx("button",{onClick:d,children:"Удалить"})]}),d=async()=>{try{c(!0);const C=await p({ids:t});l([...h.filter(o=>!t.includes(o.id))]),n([]),A.info(C.message)}finally{c(!1)}};return a?e.jsx("p",{children:"Удаление..."}):j||!u?e.jsx("p",{children:"Загрузка..."}):e.jsxs(e.Fragment,{children:[e.jsx("h2",{children:"Поля валют"}),u.isEditCurrency&&e.jsx("button",{className:i.addButton,onClick:()=>{r(M.EDIT_CURRENCY_FIELD)},children:"Добавить.."}),e.jsx(ss,{data:h,rowsSelected:t,setRowsSelected:n}),t.length>0&&e.jsx(b,{rowsSelected:t})]})}const wn=Object.freeze(Object.defineProperty({__proto__:null,default:ns},Symbol.toStringTag,{value:"Module"}));function as(){const{id:t}=le(),{currencies:n,currencyFields:a,setCurrencyFields:c,loading:r}=s.useContext(se),{activeRole:u}=s.useContext(Q),{sendCurrencyField:h,fetchCurrenciesForField:l,sendCurrenciesForField:j}=s.useContext(V),[p,b]=s.useState({name:"",isRequired:!1,hintAccountFrom:"",hintAccountTo:""}),[d,C]=s.useState(!1),[o,m]=s.useState(!!t),[I,w]=s.useState([]),[_,S]=s.useState([]),f=J(),v=a.find(y=>y.id==t);s.useEffect(()=>{const y=async()=>{try{let R=(await l({id:t})).data;w(R.give),S(R.get)}finally{m(!1)}},T=()=>{b({name:(v==null?void 0:v.name)||"",isRequired:(v==null?void 0:v.isRequired)||!1,hintAccountFrom:(v==null?void 0:v.hintAccountFrom)||"",hintAccountTo:(v==null?void 0:v.hintAccountTo)||""})};t&&(y(),T())},[r,t]);const k=y=>{const{name:T,type:R,checked:F,value:L}=y.target;b(P=>({...P,[T]:R==="checkbox"?F:L}))},N=async()=>{try{C(!0);let y={...p,...parseInt(t)?{id:parseInt(t)}:{}};const T=(await h({field:y})).data;c(R=>{const F=[...R],L=R.findIndex(P=>P.id==y.id);return L!=-1?F[L]=y:F.push({...y,id:T.id}),F}),await j({id:T.id,giveCurrencies:I,getCurrencies:_}),A.info(T.message),f(-1)}finally{C(!1)}};if(o||r||!u)return e.jsx("p",{children:"Загрузка..."});if(d)return e.jsx("p",{children:"Сохранение..."});const E=u.isEditCurrency?"Редактировать":"Просмотреть";return e.jsxs(e.Fragment,{children:[t?e.jsxs("h2",{children:[E," поле - ",v.name]}):e.jsx("h2",{children:"Создать поле"}),e.jsxs("div",{className:i.tableTwoColLayout,children:["Название: ",e.jsx("input",{name:"name",value:p.name,onChange:k}),e.jsxs("label",{className:[i.spanTwoColumns,i.oneLine].join(" "),children:[e.jsx("input",{type:"checkbox",name:"isRequired",checked:p.isRequired,onChange:k}),"Обязательное поле"]}),"Подсказка Со счета: ",e.jsx("input",{name:"hintAccountFrom",value:p.hintAccountFrom,onChange:k}),"Подсказка На счет: ",e.jsx("input",{name:"hintAccountTo",value:p.hintAccountTo,onChange:k}),"Валюты Отдаю:",e.jsx(ae,{rows:n,checkedKeys:I,onCheckChange:w,className:i.checkboxList}),"Валюты Получаю:",e.jsx(ae,{rows:n,checkedKeys:_,onCheckChange:S,className:i.checkboxList})]}),e.jsxs("div",{className:i.actionButtons,children:[u.isEditCurrency&&e.jsx("button",{id:"save",onClick:N,children:"Сохранить"}),e.jsx("button",{onClick:()=>f(-1),children:"Отмена"})]})]})}const Nn=Object.freeze(Object.defineProperty({__proto__:null,default:as},Symbol.toStringTag,{value:"Module"})),is=({data:t,rowsSelected:n,setRowsSelected:a,activeRole:c})=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:i.checkboxContainer,children:[e.jsx("input",{type:"checkbox",id:t.id,checked:n.includes(t.id),onChange:()=>{n.includes(t.id)?a(n.filter(r=>r!==t.id)):a([...n,t.id])}}),e.jsxs("span",{children:[e.jsxs("label",{htmlFor:t.id,children:[t.from.name," -> ",t.to.name]}),e.jsx("p",{className:i.links,children:e.jsx(ie,{to:`${M.EDIT_DIRECTION}/${t.id}`,children:c!=null&&c.isEditDirection?"Редактировать..":"Просмотреть.."})})]})]}),e.jsx("div",{children:t.id}),e.jsx("div",{children:t.price}),e.jsx("div",{children:t.isActive?"Активно":"Отключено"})]}),ls=({data:t,rowsSelected:n,setRowsSelected:a})=>{const{activeRole:c}=s.useContext(Q);return e.jsxs("div",{className:i.tableFourCol,children:[e.jsx("div",{children:"Название"}),e.jsx("div",{children:"ID"}),e.jsx("div",{children:"Курс"}),e.jsx("div",{children:"Статус"}),t.map((r,u)=>e.jsx(is,{data:r,rowsSelected:n,setRowsSelected:a,activeRole:c},u)),e.jsx(ue,{items:t,rowsSelected:n,setRowsSelected:a})]})},ge={MIN_AMOUNT:1,MAX_AMOUNT:2,PROFIT:3},rs=({rowsSelected:t,setRowsSelected:n,directions:a,setDirections:c,setSaving:r})=>{const u=[{id:ge.MIN_AMOUNT,name:"Мин сумма"},{id:ge.MAX_AMOUNT,name:"Макс сумма"},{id:ge.PROFIT,name:"Прибыль"}],{currencies:h,loading:l}=s.useContext(se),{sendDirections:j}=s.useContext(V),[p,b]=s.useState(1),[d,C]=s.useState(!1),o=async m=>{try{r(!0);const I={ids:t,...m};await j({directions:I});let w=a.map(S=>t.includes(S.id)?{...S,...m}:S);const _=t.map(S=>{var v,k;let f=a.find(N=>N.id==S);return`${((v=f==null?void 0:f.from)==null?void 0:v.name)||"N/A"} -> ${((k=f==null?void 0:f.to)==null?void 0:k.name)||"N/A"}`});n([]),c(w),A(`Направления обновлены: ${_.join(", ")}`)}finally{r(!1)}};return l?e.jsx("p",{children:"Загрузка.."}):e.jsxs("div",{className:i.selectedOrders,style:{paddingBottom:"0"},children:[e.jsxs("div",{style:{marginBottom:"0.5em"},children:["Выбрано ",t.length," элементов."]}),e.jsxs("div",{className:i.horzList,children:[e.jsx("button",{onClick:()=>o({isActive:!0}),children:"Активировать"}),e.jsx("button",{onClick:()=>o({isActive:!1}),children:"Деактивировать"}),e.jsx("button",{children:"Удалить"})]}),e.jsx(me,{title:"Редактировать..",isVisible:d,setIsVisible:C,child:e.jsxs("div",{className:i.directionFilter,children:[e.jsx($,{rows:u,selectedId:p,setSelectedId:b}),e.jsx(cs,{selected:p,currencyList:h,setSaving:r,updateDirections:o})]})})]})};function cs({selected:t,currencyList:n,setSaving:a,updateDirections:c}){const[r,u]=s.useState(0),[h,l]=s.useState(0),[j,p]=s.useState(0),[b,d]=s.useState(0),[C,o]=s.useState(0);switch(Number(t)){case ge.MIN_AMOUNT:return e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"number",value:r,onChange:m=>u(m.target.value)}),e.jsx($,{rows:n,selectedId:b,setSelectedId:d}),e.jsx("button",{id:"save",onClick:()=>c({minSum:r,minSumCurrency:b}),children:"Сохранить"})]});case ge.MAX_AMOUNT:return e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"number",value:h,onChange:m=>l(m.target.value)}),e.jsx($,{rows:n,selectedId:C,setSelectedId:o}),e.jsx("button",{id:"save",onClick:()=>c({maxSum:h,maxSumCurrency:C}),children:"Сохранить"})]});case ge.PROFIT:return e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"number",value:j,onChange:m=>p(m.target.value)}),e.jsx("span",{children:"%"}),e.jsx("button",{className:i.save,onClick:()=>c({profit:j}),children:"Сохранить"})]});default:console.log(`Общие настройки: Не найден элемент с индексом ${t}.`)}}function os(){const{currencies:t}=s.useContext(se),{fetchDirections:n}=s.useContext(he),{activeRole:a,loading:c}=s.useContext(Q),[r,u]=s.useState([]),[h,l]=s.useState([]),[j,p]=s.useState(!1),[b,d]=s.useState(!1),C=J(),o=100,[m,I]=s.useState(0),[w,_]=s.useState(0),[S,f]=s.useState(!1),[v,k]=s.useState(),[N,E]=s.useState(),[y,T]=s.useState(),[R,F]=s.useState(),L=[{id:"all",name:"Все валюты"},...t.map(D=>({id:D.id,name:D.name}))],P=[{id:"all",name:"Все"},{id:"active",name:"Активные"},{id:"inactive",name:"Неактивные"}];s.useEffect(()=>{(async()=>{p(!0);try{const W=m*o,B=(await n({start:W,count:o,filter:R==""?void 0:R,status:v=="all"?void 0:v,fromId:N=="all"?void 0:N,toId:y=="all"?void 0:y})).data;_(B.total),u(B.items)}finally{p(!1)}})()},[m,S]);const g=async()=>{I(0),f(!S)};return j||c?e.jsx("p",{children:"Загрузка..."}):e.jsxs(e.Fragment,{children:[e.jsx("h2",{children:"Направления обменов"}),a.isEditDirection&&e.jsx("button",{className:i.addButton,onClick:()=>{C(M.EDIT_DIRECTION)},children:"Добавить.."}),e.jsxs("div",{className:i.horzList,children:["Отдаю: ",e.jsx($,{rows:L,selectedId:N,setSelectedId:E}),"Получаю: ",e.jsx($,{rows:L,selectedId:y,setSelectedId:T})]}),e.jsxs("div",{className:i.horzList,children:["Статус: ",e.jsx($,{rows:P,selectedId:v,setSelectedId:k})]}),e.jsxs("div",{className:i.horzList,children:[e.jsxs("label",{children:["Фильтр: ",e.jsx("input",{value:R,placeholder:"Код валюты",onChange:D=>F(D.target.value)})]}),e.jsx("button",{onClick:g,children:"Применить"})]}),e.jsx(H,{total:w,currentPage:m,rowsPerPage:o,onPageChange:I,className:i.pagination}),h.length>0&&e.jsx(rs,{rowsSelected:h,setRowsSelected:l,directions:r,setDirections:u,setSaving:d}),e.jsx(ls,{data:r,rowsSelected:h,setRowsSelected:l}),e.jsx(H,{total:w,currentPage:m,rowsPerPage:o,onPageChange:I,className:i.pagination}),e.jsxs("p",{children:["Найдено направлений: ",w]})]})}const Fn=Object.freeze(Object.defineProperty({__proto__:null,default:os},Symbol.toStringTag,{value:"Module"}));function ds(){const{id:t}=le(),{currencies:n,loading:a}=s.useContext(se),{activeRole:c,loading:r}=s.useContext(Q),{fetchFormula:u,fetchDirection:h}=s.useContext(he),{fetchOrderStatuses:l,sendDirection:j}=s.useContext(V),[p,b]=s.useState(),[d,C]=s.useState(),[o,m]=s.useState({isActive:!0,isExport:!0,profit:0,minSum:0,maxSum:0}),[I,w]=s.useState(),[_,S]=s.useState(!1),[f,v]=s.useState(!1),k=J(),[N,E]=s.useState(0);s.useEffect(()=>{n&&(async()=>{var D,W,B,q,K;try{S(!0);let[X,Y]=await Promise.all([l().then(x=>x.data),t?h({id:t}).then(x=>x.data):Promise.resolve(null)]);w(X),b((Y==null?void 0:Y.fromId)||((D=n.at(0))==null?void 0:D.id)),C((Y==null?void 0:Y.toId)||((W=n.at(-1))==null?void 0:W.id)),Y||(Y={},Y.minSumCurrencyId=(B=n.at(0))==null?void 0:B.id,Y.maxSumCurrencyId=(q=n.at(0))==null?void 0:q.id,Y.statusId=(K=X.at(0))==null?void 0:K.id),m(x=>({...x,...Y}))}finally{S(!1)}})()},[n]);const y=n.filter(g=>g.id==p).map(g=>g.code),T=n.filter(g=>g.id==d).map(g=>g.code);s.useEffect(()=>{(async()=>{if(p==d)E(void 0);else{let D=await u({from:y,to:T});E(D.data)}})()},[p,d]);const R=async()=>{var g;try{v(!0);let D={...o,id:parseInt(t)||0,fromId:p,toId:d,formulaId:(N==null?void 0:N.id)||0};const W=await j({direction:D});A.info(W.message),(g=W.data.warnings)==null||g.forEach(B=>A.warn(B))}finally{v(!1)}},F=g=>{var B,q,K;const D=((B=g==null?void 0:g.target)==null?void 0:B.name)||g.name,W=((q=g==null?void 0:g.target)==null?void 0:q.type)==="checkbox"?g.target.checked:((K=g==null?void 0:g.target)==null?void 0:K.value)||g.value;m(X=>({...X,[D]:W}))};function L({id:g}){return c.isEditDirection?g?e.jsxs("h2",{children:["Редактировать направление - ",g]}):e.jsx("h2",{children:"Создать направление"}):e.jsx("h2",{children:"Просмотр направления"})}function P({rows:g,selectedId:D,setSelectedId:W,name:B}){const q=K=>{W&&W(B?{name:B,value:K.target.value}:K.target.value)};return e.jsx("select",{onChange:q,value:D??void 0,children:g.map(K=>e.jsx("option",{value:K.id??K,children:K.name??K},K.id??K))})}return a||r||_?e.jsx("p",{children:"Загрузка..."}):f?e.jsx("p",{children:"Сохранение..."}):e.jsxs(e.Fragment,{children:[e.jsx(L,{id:t}),e.jsxs("div",{children:[e.jsxs("label",{children:["Отдаю:",e.jsx(P,{rows:n.map(g=>({...g,name:`${g.name} (${g.code})`})),selectedId:p,setSelectedId:b})]}),e.jsxs("label",{children:["Получаю:",e.jsx(P,{rows:n.map(g=>({...g,name:`${g.name} (${g.code})`})),selectedId:d,setSelectedId:C})]})]}),e.jsxs("label",{className:i.oneLine,children:[e.jsx("input",{type:"checkbox",name:"isActive",checked:o.isActive,onChange:F}),"Активное направление"]}),e.jsxs("label",{className:i.oneLine,children:[e.jsx("input",{type:"checkbox",name:"isExport",checked:o.isExport,onChange:F}),"Экспорт в файл курсов"]}),e.jsx("h3",{children:"Сумма"}),e.jsx("div",{children:e.jsxs("label",{children:["Минимум:",e.jsx("input",{type:"number",name:"minSum",value:o.minSum,onChange:F}),e.jsx(P,{name:"minSumCurrencyId",rows:n,selectedId:o.minSumCurrencyId,setSelectedId:F})]})}),e.jsx("div",{children:e.jsxs("label",{children:["Максимум:",e.jsx("input",{type:"number",name:"maxSum",value:o.maxSum,onChange:F}),e.jsx(P,{name:"maxSumCurrencyId",rows:n,selectedId:o.maxSumCurrencyId,setSelectedId:F})]})}),e.jsx("h3",{children:"Курс"}),e.jsxs("p",{children:[e.jsx("b",{children:"Курс:"})," 1 ",y," = ",(N==null?void 0:N.price)||0," ",T]}),e.jsxs("p",{children:[e.jsx("b",{children:"Обратный курс:"})," 1 ",T," = ",1/(N==null?void 0:N.price)||0," ",y]}),(N==null?void 0:N.tag)&&e.jsxs("p",{children:[e.jsx("b",{children:"Формула: "}),N.tag]}),(N==null?void 0:N.lastUpdated)&&e.jsxs("p",{children:[e.jsx("b",{children:"Обновлен: "}),new Date(N.lastUpdated).toLocaleString()]}),c.isEditDirection&&e.jsx("button",{onClick:()=>k(M.FORMULAS),children:"Задать курс.."}),e.jsx("h3",{children:"Прибыль"}),e.jsx("input",{type:"number",style:{marginTop:0},name:"profit",value:o.profit,onChange:F})," %",e.jsx("h3",{children:"Статус заявок"}),e.jsxs("div",{className:i.horzList,children:[I?e.jsx(P,{rows:I,name:"statusId",selectedId:o.statusId,setSelectedId:F}):"Нет шаблонов",c.isEditDirection&&e.jsx("button",{onClick:()=>k(I?M.ORDER_STATUS:M.EDIT_ORDER_STATUS),children:I?"Редактировать..":"Добавить.."})]}),c.isEditDirection&&e.jsxs("div",{className:i.actionButtons,children:[e.jsx("button",{className:i.save,onClick:R,children:"Сохранить"}),e.jsx("button",{className:i.cancel,children:"Отмена"})]})]})}const En=Object.freeze(Object.defineProperty({__proto__:null,default:ds},Symbol.toStringTag,{value:"Module"})),us=({data:t})=>{let n=0;return t.sell!=0&&t.buy!=0&&(n=(t.sell-t.buy)/t.buy*100,Math.abs(n)<.01?n=n.toFixed(6):n=n.toFixed(2),n+=" %"),e.jsxs(e.Fragment,{children:[e.jsx("div",{children:t.from}),e.jsx("div",{children:t.to}),e.jsx("div",{children:t.tag}),e.jsx("div",{children:t.buy||t.price}),e.jsx("div",{children:n})]})},hs=({data:t})=>e.jsxs("div",{className:i.tableFiveCol,children:[e.jsx("div",{children:"Отдаю"}),e.jsx("div",{children:"Получаю"}),e.jsx("div",{children:"Формула"}),e.jsx("div",{children:"Курс"}),e.jsx("div",{children:"Спред"}),t.map((n,a)=>e.jsx(us,{data:n},a))]});function xs(){const{fetchCourses:t}=s.useContext(V),[n,a]=s.useState(!0),[c,r]=s.useState([]),u=100,[h,l]=s.useState(0),[j,p]=s.useState(0),[b,d]=s.useState(),[C,o]=s.useState(),[m,I]=s.useState(),[w,_]=s.useState();s.useEffect(()=>{(async()=>{try{const v=h*u,k=(await t({start:v,count:u,filter:b,exchange:m!=="Все"?m:void 0})).data;r(k.items),p(k.total)}finally{a(!1)}})()},[h,b,m]);const S=async()=>{l(0),d(C),I(w)};return n?e.jsx("p",{children:"Загрузка..."}):e.jsxs(e.Fragment,{children:[e.jsx("h2",{children:"Список курсов"}),e.jsxs("label",{children:["Биржа:",e.jsx($,{rows:["Все","Bybit","Binance","CoinMarketCap","Cbr","Mexc"],setSelectedId:_})]}),e.jsxs("div",{className:i.horzLine,children:[e.jsxs("label",{children:["Фильтр: ",e.jsx("input",{value:C,onChange:f=>o(f.target.value),placeholder:"Код валюты или формула"})]}),e.jsx("button",{onClick:S,children:"Применить"})]}),e.jsx(H,{total:j,currentPage:h,rowsPerPage:u,onPageChange:l,className:i.pagination}),e.jsx(hs,{data:c}),e.jsx(H,{total:j,currentPage:h,rowsPerPage:u,onPageChange:l,className:i.pagination}),e.jsxs("p",{children:["Найдено курсов: ",j]})]})}const kn=Object.freeze(Object.defineProperty({__proto__:null,default:xs},Symbol.toStringTag,{value:"Module"})),js=({rowsSelected:t,setRowsSelected:n,status:a,setSaving:c,loadOrders:r})=>{const{sendOrders:u}=s.useContext(V),[h,l]=s.useState(a[0].id),j=async()=>{try{c(!0);let p=await u({ids:t,status:h});A.info(p.message),n([]),r()}finally{c(!1)}};return e.jsxs("div",{className:[i.actionButtons,i.selectedOrders].join(" "),children:[e.jsxs("p",{children:["Выбрано ",t.length," заявок."]}),e.jsxs("label",{children:["Статус заявки:",e.jsx($,{rows:a,selectedId:h,setSelectedId:l})]}),e.jsx("button",{onClick:j,children:"Сохранить"})]})};function ms({bids:t,rowsSelected:n,setRowsSelected:a}){const c=J();return e.jsx(e.Fragment,{children:t.map(r=>{var u;return e.jsxs(at.Fragment,{children:[e.jsxs("label",{className:i.labelBid,children:[e.jsx("input",{type:"checkbox",id:r.id,checked:n.includes(r.id),onChange:()=>{n.includes(r.id)?a(n.filter(h=>h!==r.id)):a([...n,r.id])}}),"ID: ",r.id]}),e.jsxs("div",{className:i.tableBidLayout,children:[e.jsxs("div",{children:[e.jsx("p",{children:e.jsx("span",{className:i[`order-${r.status}`]||"",children:((u=je.find(h=>h.id===r.status))==null?void 0:u.name)||r.status})}),e.jsxs("p",{children:[e.jsx("b",{children:"Дата создания:"})," ",new Date(r.dateCreated).toLocaleString()]}),e.jsxs("p",{children:[e.jsx("b",{children:"Дата изменения:"})," ",new Date(r.dateUpdated).toLocaleString()]}),e.jsxs("p",{children:[e.jsx("b",{children:"Курс:"})," ",r.course]}),r.profit!=0&&e.jsxs("p",{children:[e.jsx("b",{children:"Прибыль:"})," ",r.profit," USDT / ",(r.profit/(r.from.amount*r.rateGive)*100).toFixed(2),"%"]}),r.referral?e.jsxs("p",{children:[e.jsx("b",{children:"Реферал:"})," ",r.referral]}):""]}),e.jsxs("div",{children:[e.jsxs("p",{children:[e.jsx("b",{children:"Отдаю:"})," ",r.from.name]}),e.jsxs("p",{children:[e.jsx("b",{children:"Сумма:"})," ",r.from.amount]}),e.jsxs("p",{children:[e.jsx("b",{children:"Со счета:"})," ",r.walletFrom]}),r.isManualGive&&e.jsxs("p",{children:[e.jsx("b",{children:"Ручной курс:"})," ",r.rateGive]}),e.jsx(Ye,{fields:r.fieldsGive})]}),e.jsxs("div",{children:[e.jsxs("p",{children:[e.jsx("b",{children:"Получаю:"})," ",r.to.name]}),e.jsxs("p",{children:[e.jsx("b",{children:"Сумма:"})," ",r.to.amount]}),e.jsxs("p",{children:[e.jsx("b",{children:"На счет:"})," ",r.walletTo]}),r.isManualGet&&e.jsxs("p",{children:[e.jsx("b",{children:"Ручной курс:"})," ",r.rateGet]}),r.amlRisk?e.jsxs("p",{children:[e.jsx("b",{children:"AML риск:"})," ",r.amlRisk]}):"",e.jsx(Ye,{fields:r.fieldsGet})]}),e.jsxs("div",{children:[e.jsxs("p",{children:[e.jsx("b",{children:"Пользователь:"})," ",r.userName]}),e.jsxs("p",{children:[e.jsx("b",{children:"Почта:"})," ",r.userMail]}),r.requisites?e.jsxs("p",{children:[e.jsx("b",{children:"Реквизиты:"})," ",r.requisites]}):""]}),e.jsxs("div",{className:[i.spanFourColumns,i.tableBidBottom].join(" "),children:[e.jsx("button",{onClick:()=>c(`${M.EDIT_ORDER}/${r.id}`),children:"Редактировать.."}),e.jsx("button",{onClick:()=>{c(`${M.ORDER_LOG}/${r.id}`,{state:{statusHistory:r.statusHistory}})},children:"Лог заявки.."})]})]})]},r.id)})})}function Ye({fields:t}){return!t||Object.keys(t).length===0?null:e.jsx(e.Fragment,{children:Object.entries(t).map(([n,a])=>e.jsxs("p",{children:[e.jsxs("b",{children:[n,":"]})," ",a]},n))})}function Ze({rows:t,selectedId:n,setSelectedId:a,name:c}){const r=u=>{a&&a(c?{name:c,value:u.target.value}:u.target.value)};return e.jsx("select",{onChange:r,value:n??void 0,children:t.map(u=>e.jsx("option",{value:u.id??u,children:u.name??u},u.id??u))})}function fs(){const{fetchOrders:t}=s.useContext(V),[n,a]=s.useState(!0),[c,r]=s.useState(!1),[u,h]=s.useState([]),[l,j]=s.useState([]),[p,b]=s.useState(0),[d,C]=s.useState(0),o=10,m=new Date;m.setHours(0,0,0,0);const I=m.getTimezoneOffset()*6e4,_=new Date(m.getTime()-I).toISOString().slice(0,16),[S,f]=s.useState({dateStart:sessionStorage.getItem("dateOrdersStart")||_}),[v,k]=s.useState(!1),N=T=>{var L,P;const R=((L=T==null?void 0:T.target)==null?void 0:L.name)||T.name,F=((P=T==null?void 0:T.target)==null?void 0:P.value)||T.value;f(g=>({...g,[R]:F}))};s.useEffect(()=>{sessionStorage.setItem("dateOrdersStart",S.dateStart)},[S.dateStart]);const E=async()=>{try{a(!0);const T=p*o,R=S.status==="Все"?Te(S,"status"):S,F=(await t({...R,start:T,count:o})).data;C(F.total),h(F.items)}finally{a(!1)}},y=()=>{p==0?E():b(0)};return s.useEffect(()=>{E()},[p]),n?e.jsx("p",{children:"Загрузка..."}):c?e.jsx("p",{children:"Сохранение..."}):e.jsxs(e.Fragment,{children:[e.jsx("h2",{children:"Заявки"}),e.jsx(me,{title:"Фильтр",isVisible:v,setIsVisible:k,styles:i,child:e.jsxs("div",{className:i.tableOrders,children:[e.jsx("div",{children:e.jsxs("label",{children:["ID:",e.jsx("input",{type:"number",value:S==null?void 0:S.id,name:"id",onChange:N})]})}),e.jsxs("div",{children:[e.jsxs("label",{children:["Дата от: ",e.jsx("input",{type:"datetime-local",value:S==null?void 0:S.dateStart,name:"dateStart",onChange:N})]}),e.jsxs("label",{children:["Дата до: ",e.jsx("input",{type:"datetime-local",value:S==null?void 0:S.dateEnd,name:"dateEnd",onChange:N})]})]}),e.jsxs("label",{children:["Статус:",e.jsx(Ze,{name:"status",rows:["Все",...je],selectedId:S==null?void 0:S.status,setSelectedId:N})]}),e.jsxs("label",{children:["Имя, почта, кошелек, реквизиты:",e.jsx("input",{name:"filter",value:S==null?void 0:S.filter,onChange:N})]}),e.jsx("button",{onClick:y,children:"Применить фильтр"})]})}),l.length>0&&e.jsx(js,{rowsSelected:l,setRowsSelected:j,status:je,setSaving:r,loadOrders:E}),e.jsx(H,{total:d,currentPage:p,rowsPerPage:o,onPageChange:b,className:i.pagination}),e.jsx(ms,{bids:u,rowsSelected:l,setRowsSelected:j,dateStart:S.dateStart}),e.jsx(H,{total:d,currentPage:p,rowsPerPage:o,onPageChange:b,className:i.pagination}),e.jsxs("p",{children:["Найдено заявок: ",d]})]})}const In=Object.freeze(Object.defineProperty({__proto__:null,default:fs},Symbol.toStringTag,{value:"Module"})),gs=({data:t,handleConfirm:n})=>{var a;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[t.userName," | ",t.userMail]}),e.jsx("div",{children:t.amount}),e.jsxs("div",{children:[((a=Xe.find(c=>c.id==t.status))==null?void 0:a.name)||t.status,t.isActive?e.jsx("button",{onClick:()=>n({userId:t.userId}),children:"Отметить как завершенный"}):"Выполнено"]}),e.jsx("div",{children:new Date(t.dateCreated).toLocaleString()})]})},ps=({data:t,handleConfirm:n})=>t.length==0?e.jsx("div",{children:"Нет данных"}):e.jsxs("div",{className:i.tableFourCol,children:[e.jsx("div",{children:"Пользователь | Почта"}),e.jsx("div",{children:"Сумма, USDT"}),e.jsx("div",{children:"Статус"}),e.jsx("div",{children:"Дата"}),t.map((a,c)=>e.jsx(gs,{data:a,handleConfirm:n},c))]});function Cs(){var F,L,P;const[t,n]=s.useState(),[a,c]=s.useState(!0),[r,u]=s.useState(!1),[h,l]=s.useState(),[j,p]=s.useState(),[b,d]=s.useState(),[C,o]=s.useState(),[m,I]=s.useState(!1),[w,_]=s.useState(0),S=10,{fetchCashbackStatus:f,fetchOptions:v,sendOptions:k,sendCashbackConfirm:N}=s.useContext(V);async function E(){try{c(!0);const g=w*S;let[D,W]=await Promise.all([f({start:g,count:S,userMail:C,dateStart:j==null?void 0:j.concat("T00:00"),dateEnd:b==null?void 0:b.concat("T00:00")}).then(B=>B.data),v().then(B=>B.data)]);l(D),n(W)}finally{c(!1)}}async function y({userId:g}){try{u(!0);let D=await N({userId:g});A.info(D.message),E()}finally{u(!1)}}async function T(){try{u(!0);let g=await k({opt:t});A.info(g.message)}finally{u(!1)}}function R(){w==0?E():_(0)}return s.useEffect(()=>{E()},[w]),a?e.jsx("p",{children:"Загрузка..."}):r?e.jsx("p",{children:"Сохранение..."}):e.jsxs(e.Fragment,{children:[e.jsx("h2",{children:"Бонусы для пользователей"}),e.jsxs("div",{className:i.horzList,children:[e.jsx("input",{type:"number",value:t.cashbackPercent,onChange:g=>n({...t,cashbackPercent:g.target.value})})," % ",e.jsx($,{rows:Se,selectedId:t.cashbackType,setSelectedId:g=>n({...t,cashbackType:g})})]}),"Можно задать для каждого пользователя свой процент.",e.jsxs("p",{children:[e.jsx("b",{children:"Всего начислено:"}),"  ",(h==null?void 0:h.sum)||0," USDT"]}),e.jsxs("p",{children:[e.jsx("b",{children:"Всего выплачено:"}),"  ",(h==null?void 0:h.payed)||0," USDT"]}),e.jsxs("p",{children:[e.jsx("b",{children:"Баланс:"}),"  ",(h==null?void 0:h.sum)-(h==null?void 0:h.payed)||0," USDT"]}),e.jsx("button",{className:i.save,onClick:T,children:"Сохранить"}),e.jsx("h3",{style:{marginTop:"2em"},children:"Запросы на выплату"}),e.jsx(me,{title:"Фильтр",isVisible:m,setIsVisible:I,styles:i,child:e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginBottom:"1em"},children:[e.jsxs("label",{children:["Дата от: ",e.jsx("input",{type:"date",value:j,name:"dateStart",onChange:g=>p(g.target.value)})]}),e.jsxs("label",{children:["Дата до: ",e.jsx("input",{type:"date",value:b,name:"dateEnd",onChange:g=>d(g.target.value)})]})]}),e.jsx("div",{style:{marginBottom:"1em"},children:e.jsxs("label",{children:["Почта пользователя: ",e.jsx("input",{type:"text",value:C,name:"email",onChange:g=>o(g.target.value)})]})}),e.jsx("button",{onClick:R,children:"Применить"})]})}),e.jsx(H,{total:(F=h==null?void 0:h.payouts)==null?void 0:F.first,currentPage:w,rowsPerPage:S,onPageChange:_,styles:i}),e.jsx(ps,{data:(L=h==null?void 0:h.payouts)==null?void 0:L.second,handleConfirm:y}),e.jsx(H,{total:(P=h==null?void 0:h.payouts)==null?void 0:P.first,currentPage:w,rowsPerPage:S,onPageChange:_,styles:i})]})}const On=Object.freeze(Object.defineProperty({__proto__:null,default:Cs},Symbol.toStringTag,{value:"Module"})),vs=({data:t,handleConfirm:n})=>{var a;return e.jsxs(e.Fragment,{children:[e.jsx("div",{children:t.id}),e.jsx("div",{children:t.amount}),e.jsxs("div",{children:[((a=Xe.find(c=>c.id==t.status))==null?void 0:a.name)||t.status,t.status=="pending"&&e.jsx("button",{onClick:()=>n({rid:t.refId}),children:"Отметить как завершенный"})]}),e.jsx("div",{children:new Date(t.dateCreated).toLocaleString()})]})},ys=({data:t,handleConfirm:n})=>t.length==0?e.jsx("div",{children:"Нет данных"}):e.jsxs("div",{className:i.tableFourCol,children:[e.jsx("div",{children:"Реферал"}),e.jsx("div",{children:"Сумма, USDT"}),e.jsx("div",{children:"Статус"}),e.jsx("div",{children:"Дата"}),t.map((a,c)=>e.jsx(vs,{data:a,handleConfirm:n},c))]});function bs(){var F,L,P;const{fetchReferralsStatus:t,fetchOptions:n,sendOptions:a,sendReferralsConfirm:c}=s.useContext(V),[r,u]=s.useState(!0),[h,l]=s.useState(!1),[j,p]=s.useState(),[b,d]=s.useState(),[C,o]=s.useState(),[m,I]=s.useState(),[w,_]=s.useState(!1),[S,f]=s.useState(0),v=10,[k,N]=s.useState();async function E(){try{u(!0);const g=S*v;let[D,W]=await Promise.all([t({start:g,count:v,refMail:m,dateStart:b==null?void 0:b.concat("T00:00"),dateEnd:C==null?void 0:C.concat("T00:00")}).then(B=>B.data),n().then(B=>B.data)]);p(D),N(W)}finally{u(!1)}}async function y(){try{l(!0);let g=await a({opt:k});A.info(g.message)}finally{l(!1)}}async function T({rid:g}){try{l(!0);let D=await c({rid:g});A.info(D.data.message),E()}finally{l(!1)}}s.useEffect(()=>{E()},[S]);function R(){S==0?E():f(0)}return r?e.jsx("p",{children:"Загрузка..."}):h?e.jsx("p",{children:"Сохранение..."}):e.jsxs(e.Fragment,{children:[e.jsx("h2",{children:"Бонусы для рефералов"}),"Политика по умолчанию при обмене по реф.ссылке:",e.jsxs("div",{className:i.horzList,children:["Начислить кэшбек ",e.jsx("input",{type:"number",value:k.referralPercent,onChange:g=>N({...k,referralPercent:g.target.value})})," % ",e.jsx($,{rows:Se,selectedId:k.referralType,setSelectedId:g=>N({...k,referralType:g})})]}),"Можно задать для каждого реферала свой процент.",e.jsxs("p",{children:[e.jsx("b",{children:"Всего начислено:"}),"  ",(j==null?void 0:j.sum)||0," USDT"]}),e.jsxs("p",{children:[e.jsx("b",{children:"Всего выплачено:"}),"  ",(j==null?void 0:j.payed)||0," USDT"]}),e.jsxs("p",{children:[e.jsx("b",{children:"Баланс:"}),"  ",(j==null?void 0:j.sum)-(j==null?void 0:j.payed)||0," USDT"]}),e.jsx("button",{className:i.save,onClick:y,children:"Сохранить"}),e.jsx("h3",{style:{marginTop:"2em"},children:"Запросы на выплату"}),e.jsx(me,{title:"Фильтр",isVisible:w,setIsVisible:_,styles:i,child:e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginBottom:"1em"},children:[e.jsxs("label",{children:["Дата от: ",e.jsx("input",{type:"date",value:b,name:"dateStart",onChange:g=>d(g.target.value)})]}),e.jsxs("label",{children:["Дата до: ",e.jsx("input",{type:"date",value:C,name:"dateEnd",onChange:g=>o(g.target.value)})]})]}),e.jsx("div",{style:{marginBottom:"1em"},children:e.jsxs("label",{children:["Почта реферала: ",e.jsx("input",{type:"text",value:m,name:"email",onChange:g=>I(g.target.value)})]})}),e.jsx("button",{onClick:R,children:"Применить"})]})}),e.jsx(H,{total:(F=j==null?void 0:j.payouts)==null?void 0:F.first,currentPage:S,rowsPerPage:v,onPageChange:f,styles:i}),e.jsx(ys,{data:(L=j==null?void 0:j.payouts)==null?void 0:L.second,handleConfirm:T}),e.jsx(H,{total:(P=j==null?void 0:j.payouts)==null?void 0:P.first,currentPage:S,rowsPerPage:v,onPageChange:f,styles:i})]})}const Rn=Object.freeze(Object.defineProperty({__proto__:null,default:bs},Symbol.toStringTag,{value:"Module"}));function Ss(){const{id:t}=le(),{sendOrders:n,fetchOrder:a}=s.useContext(V),[c,r]=s.useState(!1),[u,h]=s.useState(!0),[l,j]=s.useState({}),p=d=>{var m,I;const C=((m=d==null?void 0:d.target)==null?void 0:m.name)||d.name,o=((I=d==null?void 0:d.target)==null?void 0:I.value)||d.value;j(w=>({...w,[C]:o}))},b=async()=>{try{r(!0);let d=await n({...l,ids:[t],rateGive:l.rateGive?1/l.rateGive:null});A.info(d.message)}finally{r(!1)}};return s.useEffect(()=>{(async()=>{try{h(!0);const C=(await a({id:t})).data;console.log(C),j({...C,rateGive:C.rateGive>0?1/C.rateGive:""})}finally{h(!1)}})()},[]),u?e.jsx("p",{children:"Загрузка..."}):c?e.jsx("p",{children:"Сохранение..."}):e.jsxs(e.Fragment,{children:[e.jsxs("h2",{children:["Редактировать заявку ",t]}),e.jsxs("div",{className:i.tableTwoColLayout,children:[e.jsx("label",{htmlFor:"user",children:"Пользователь:"}),e.jsx("div",{children:l==null?void 0:l.userMail}),e.jsx("label",{htmlFor:"obmen",children:"Обмен:"}),e.jsxs("div",{children:[l==null?void 0:l.from.amount," ",l==null?void 0:l.from.code," -> ",l==null?void 0:l.to.amount," ",l==null?void 0:l.to.code]}),e.jsx("label",{htmlFor:"statusList",children:"Статус заявки:"}),e.jsx(Ze,{name:"status",rows:je,selectedId:l==null?void 0:l.status,setSelectedId:p}),e.jsx("label",{htmlFor:"walletFrom",children:"Счет Отдаю:"}),e.jsx("input",{id:"walletFrom",name:"walletFrom",value:l==null?void 0:l.walletFrom,onChange:p}),(l==null?void 0:l.isManualGive)&&e.jsxs(e.Fragment,{children:[e.jsx("label",{htmlFor:"rateGive",children:"Курс Отдаю:"}),e.jsxs("div",{children:[e.jsx("input",{id:"rateGive",name:"rateGive",type:"number",value:l==null?void 0:l.rateGive,onChange:p}),"  USDT/",l==null?void 0:l.from.code]})]}),e.jsx("label",{htmlFor:"requisites",children:"Реквизиты:"}),e.jsx("textarea",{id:"requisites",name:"requisites",value:l==null?void 0:l.requisites,onChange:p,rows:"10",cols:"40",style:{width:"100%"}}),(l==null?void 0:l.isManualGet)&&e.jsxs(e.Fragment,{children:[e.jsx("label",{htmlFor:"rateGet",children:"Курс Получаю:"}),e.jsxs("div",{children:[e.jsx("input",{id:"rateGet",name:"rateGet",type:"number",value:l==null?void 0:l.rateGet,onChange:p}),"  USDT/",l==null?void 0:l.to.code]})]})]}),e.jsx("div",{className:i.actionButtons,children:e.jsx("button",{className:i.save,onClick:b,children:"Сохранить"})})]})}const Ln=Object.freeze(Object.defineProperty({__proto__:null,default:Ss},Symbol.toStringTag,{value:"Module"}));function _s(){const{id:t}=le(),n=it(),{statusHistory:a}=n.state||{};return!a||a.length==0?e.jsxs(e.Fragment,{children:[e.jsxs("h2",{children:["Лог заявки ",t]}),e.jsx("div",{children:"Лог заявки пуст."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("h2",{children:["Лог заявки ",t]}),e.jsxs("div",{className:i.tableThreeCol,children:[e.jsx("div",{children:"Дата"}),e.jsx("div",{children:"Где сделано"}),e.jsx("div",{children:"Cтатус"}),a.map(c=>e.jsxs(e.Fragment,{children:[e.jsx("div",{children:new Date(c.date).toLocaleString()}),e.jsx("div",{children:lt.find(r=>r.id===c.src).name||c.src}),e.jsx("div",{children:je.find(r=>r.id===c.status).name||c.status})]}))]})]})}const Pn=Object.freeze(Object.defineProperty({__proto__:null,default:_s},Symbol.toStringTag,{value:"Module"}));function Ts(){const{currencyList:t}=s.useContext(se);return e.jsxs(e.Fragment,{children:[e.jsx("h2",{children:"Добавить группу направлений"}),e.jsx("h3",{children:"Отдаю - получаю"}),e.jsxs("div",{className:i.tableTwoColLayout,style:{gridTemplateColumns:"1fr 1fr"},children:[e.jsx(ae,{rows:t,className:i.checkboxList}),e.jsx(ae,{rows:t,className:i.checkboxList})]}),e.jsx("div",{className:i.actionButtons,children:e.jsx("button",{className:i.save,children:"Сохранить"})})]})}const Un=Object.freeze(Object.defineProperty({__proto__:null,default:Ts},Symbol.toStringTag,{value:"Module"}));function oe({message:t}){return t?e.jsx("p",{className:i.validationWarning,children:t}):null}function ws(){var k,N;const{fetchOptions:t,sendOptions:n,fetchAdminNotify:a,sendAdminNotify:c}=s.useContext(V),[r,u]=s.useState(),[h,l]=s.useState(""),[j,p]=s.useState(""),[b,d]=s.useState(),[C,o]=s.useState(!0),[m,I]=s.useState(!1),[w,_]=s.useState("new");s.useEffect(()=>{m||(async()=>{var y,T;try{o(!0);const[R,F]=await Promise.all([t().then(L=>L.data),a().then(L=>L.data)]);u(R),d(F),p(((y=F==null?void 0:F[w])==null?void 0:y.text)||""),l(((T=F==null?void 0:F[w])==null?void 0:T.subject)||"")}finally{o(!1)}})()},[t,m]),s.useEffect(()=>{const E=b==null?void 0:b[w];l((E==null?void 0:E.subject)||""),p((E==null?void 0:E.text)||"")},[w]);async function S(){I(!0);try{const[E,y]=await Promise.all([n({opt:r}),c({notify:b})]);E.type=="success"&&y.type=="success"?A.success("Уведомления сохранены"):A.error("Не удалось сохранить уведомления")}finally{I(!1)}}const f=E=>{const{name:y,value:T,type:R}=E.target,F=R==="number"?parseInt(T):T;u({...r,[y]:F})},v=(E,y,T)=>{d(R=>{var F,L;return{...R,[E]:{...R[E],text:y==="text"?T:((F=R[E])==null?void 0:F.text)||"",subject:y==="subject"?T:((L=R[E])==null?void 0:L.subject)||""}}}),y==="text"?p(T):l(T)};return C?e.jsx("p",{children:"Загрузка..."}):m?e.jsx("p",{children:"Сохранение..."}):e.jsxs(e.Fragment,{children:[e.jsx("h2",{children:"Уведомления администратору"}),e.jsx("div",{children:e.jsxs("label",{children:["Токен бота:",e.jsx("input",{name:"telegramBotToken",value:r.telegramBotToken,onChange:f}),e.jsx(oe,{message:(k=r==null?void 0:r.validation)==null?void 0:k.telegramBotToken})]})}),e.jsx("div",{children:e.jsxs("label",{children:["Имя бота:",e.jsx("input",{name:"telegramBotName",value:r.telegramBotName,onChange:f}),e.jsx(oe,{message:(N=r==null?void 0:r.validation)==null?void 0:N.telegramBotName})]})}),e.jsx("div",{children:e.jsxs("label",{children:["ID группы в Telegram:",e.jsx("input",{name:"telegramGroupId",value:r.telegramGroupId,onChange:f})]})}),e.jsxs("label",{children:["Электронная почта администратора:",e.jsx("input",{name:"adminEmail",value:r.adminEmail,onChange:f})]}),e.jsx("h3",{children:"Настроить"}),e.jsxs("div",{className:i.container,children:[e.jsxs("label",{children:["Статус заявки:   ",e.jsx($,{rows:je,selectedId:w,setSelectedId:_})]}),e.jsx("div",{children:e.jsx("input",{placeholder:"Тема письма",value:h,onChange:E=>v(w,"subject",E.target.value)})}),e.jsx("div",{children:e.jsx("textarea",{rows:"8",cols:"30",style:{width:"50%"},value:j,onChange:E=>v(w,"text",E.target.value)})}),"Можно использовать теги в квадратных скобках, например:",e.jsxs("ul",{style:{marginTop:"0"},children:[e.jsx("li",{children:"[id] - номер заявки;"}),e.jsx("li",{children:"[requisites] - реквизиты (для ручных направлений);"}),e.jsx("li",{children:"[profit] - прибыль, %;"}),e.jsx("li",{children:"[email] - почта пользователя;"}),e.jsx("li",{children:"[profitPercent] - прибыль, %;"}),e.jsx("li",{children:"[profitUsdt] - прибыль, USDT;"}),e.jsx("li",{children:"[walletFrom] - кошелек Отдаю;"}),e.jsx("li",{children:"[walletTo] - кошелек Получаю;"}),e.jsx("li",{children:"[amountFrom] - колич.валюты Отдаю;"}),e.jsx("li",{children:"[amountTo] - колич валюты Получаю;"}),e.jsx("li",{children:"[receiveType] - модуль приема: Ручной (оператор, рубли) / Авто (криптовалюта);"}),e.jsx("li",{children:"[sendType] - модуль отправки: Ручной / Авто;"}),e.jsx("li",{children:"[currencyFrom] - валюта Отдаю;"}),e.jsx("li",{children:"[currencyTo] - валюта Получаю."})]}),e.jsx("button",{className:i.save,onClick:S,children:"Сохранить"})]})]})}const Mn=Object.freeze(Object.defineProperty({__proto__:null,default:ws},Symbol.toStringTag,{value:"Module"}));function Ns(){const{fetchUsersNotify:t,sendUsersNotify:n}=s.useContext(V),{activeRole:a,loading:c}=s.useContext(Q),[r,u]=s.useState(""),[h,l]=s.useState(""),[j,p]=s.useState("new"),[b,d]=s.useState(),[C,o]=s.useState(!0),[m,I]=s.useState(!1),w=[...je,{id:"newUser",name:"Регистрация на сайте"},{id:"registrationSuccess",name:"Регистрация завершена"}],_=(f,v,k)=>{d(N=>{var E,y;return{...N,[f]:{...N[f],text:v==="text"?k:((E=N[f])==null?void 0:E.text)||"",subject:v==="subject"?k:((y=N[f])==null?void 0:y.subject)||""}}}),v==="text"?l(k):u(k)},S=async()=>{I(!0);try{let f=await n({notify:b});A.info(f.message)}finally{I(!1)}};return s.useEffect(()=>{(async()=>{var v,k;try{o(!0);let N=(await t()).data;d(N),l(((v=N==null?void 0:N[j])==null?void 0:v.text)||""),u(((k=N==null?void 0:N[j])==null?void 0:k.subject)||"")}finally{o(!1)}})()},[]),s.useEffect(()=>{console.log(j);const f=b==null?void 0:b[j];u((f==null?void 0:f.subject)||""),l((f==null?void 0:f.text)||"")},[j]),C||c?e.jsx("p",{children:"Загрузка..."}):m?e.jsx("p",{children:"Сохранение..."}):e.jsxs(e.Fragment,{children:[e.jsx("h2",{children:"Уведомления пользователям"}),e.jsxs("label",{children:["Статус заявки",e.jsx($,{rows:w,selectedId:j,setSelectedId:p})]}),e.jsx("div",{children:e.jsx("input",{placeholder:"Тема письма",value:r,onChange:f=>_(j,"subject",f.target.value)})}),e.jsx("div",{children:e.jsx("textarea",{rows:"8",cols:"30",style:{width:"50%"},value:h,onChange:f=>_(j,"text",f.target.value)})}),e.jsxs("div",{children:["Можно использовать теги в квадратных скобках, например:",e.jsxs("ul",{children:[e.jsx("li",{children:"[register] - ссылка для регистрации со случайным кодом;"}),e.jsx("li",{children:"[login] - имя пользователя (почта);"}),e.jsx("li",{children:"[password] - пароль после успешной регистрации;"}),e.jsx("li",{children:"[id] - номер заявки;"}),e.jsx("li",{children:"[requisites] - реквизиты (для ручных направлений);"}),e.jsx("li",{children:"[email] - почта пользователя;"}),e.jsx("li",{children:"[walletFrom] - кошелек Отдаю;"}),e.jsx("li",{children:"[walletTo] - кошелек Получаю;"}),e.jsx("li",{children:"[amountFrom] - колич.валюты Отдаю;"}),e.jsx("li",{children:"[amountTo] - колич валюты Получаю;"}),e.jsx("li",{children:"[receiveType] - модуль приема: Ручной (оператор, рубли) / Авто (криптовалюта);"}),e.jsx("li",{children:"[sendType] - модуль отправки: Ручной / Авто;"}),e.jsx("li",{children:"[currencyFrom] - валюта Отдаю;"}),e.jsx("li",{children:"[currencyTo] - валюта Получаю."})]})]}),a.isEditNotify&&e.jsx("button",{className:i.save,onClick:S,children:"Сохранить"})]})}const Dn=Object.freeze(Object.defineProperty({__proto__:null,default:Ns},Symbol.toStringTag,{value:"Module"})),Fs=({serverTimezoneOffset:t})=>{const[n,a]=s.useState(()=>{const c=new Date,r=c.getTimezoneOffset();return c.setMinutes(c.getMinutes()+r+t),c});return s.useEffect(()=>{const c=setInterval(()=>{const r=new Date,u=r.getTimezoneOffset();r.setMinutes(r.getMinutes()+u+t),a(r)},1e3);return()=>clearInterval(c)},[t]),e.jsx(e.Fragment,{children:n.toLocaleTimeString()})},Es=({data:t,rowsSelected:n,setRowsSelected:a})=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:i.checkboxContainer,children:[e.jsx("input",{type:"checkbox",id:t.id,checked:n.includes(t.id),onChange:()=>{n.includes(t.id)?a(n.filter(c=>c!==t.id)):a([...n,t.id])}}),e.jsxs("span",{children:[e.jsx("label",{htmlFor:t.id,children:t.time}),e.jsx(ie,{className:i.links,to:`${M.EDIT_TIMETABLE}/${t.id}`,children:"Редактировать.."})]})]}),e.jsx("div",{children:t.currency})]}),ks=({data:t,rowsSelected:n,setRowsSelected:a})=>e.jsxs("div",{className:i.tableTwoCol,children:[e.jsx("div",{children:"Время"}),e.jsx("div",{children:"Валюта"}),t.map((c,r)=>e.jsx(Es,{data:c,rowsSelected:n,setRowsSelected:a},r))]}),Ne=["UTC-12:00","UTC-11:30","UTC-11:00","UTC-10:30","UTC-10:00","UTC-09:30","UTC-09:00","UTC-08:30","UTC-08:00","UTC-07:30","UTC-07:00","UTC-06:30","UTC-06:00","UTC-05:30","UTC-05:00","UTC-04:30","UTC-04:00","UTC-03:30","UTC-03:00","UTC-02:30","UTC-02:00","UTC-01:30","UTC-01:00","UTC-00:30","UTC+00:00","UTC+00:30","UTC+01:00","UTC+01:30","UTC+02:00","UTC+02:30","UTC+03:00","UTC+03:30","UTC+04:00","UTC+04:30","UTC+05:00","UTC+05:30","UTC+05:45","UTC+06:00","UTC+06:30","UTC+07:00","UTC+07:30","UTC+08:00","UTC+08:30","UTC+08:45","UTC+09:00","UTC+09:30","UTC+10:00","UTC+10:30","UTC+11:00","UTC+11:30","UTC+12:00","UTC+12:45","UTC+13:00","UTC+13:45","UTC+14:00"].map((t,n)=>({id:n,name:t}));function Is(t){const n=t>=0?"+":"-",a=Math.abs(t),c=Math.floor(a/60),r=a%60;return`UTC${n}${String(c).padStart(2,"0")}:${String(r).padStart(2,"0")}`}function Os(t){var a;let n=Is(t);return(a=Ne.find(c=>c.name===n))==null?void 0:a.id}function Rs(t){var h;const a=((h=Ne.find(l=>l.id==t))==null?void 0:h.name).match(/^UTC([+-])(\d{1,2}):(\d{2})$/);if(!a)throw new Error("Перевод UTC в минуты: Некорректный формат, ожидаем UTC±hh:mm");const c=a[1]==="+"?1:-1,r=parseInt(a[2],10),u=parseInt(a[3],10);return c*(r*60+u)}function Ls(){var w,_,S,f,v,k,N;const{fetchOptions:t,sendOptions:n}=s.useContext(V),[a,c]=s.useState(),[r,u]=s.useState(!0),[h,l]=s.useState(!1),[j,p]=s.useState();s.useContext(se).currencies.map(E=>({...E,name:E.code})).reduce((E,y)=>(E.some(R=>R.code===y.code)||E.push(y),E),[]);const b=J(),[d,C]=s.useState([]),o=E=>{const{name:y,value:T,type:R}=E.target,F=R==="number"?parseInt(T):R==="checkbox"?E.target.checked:T;c({...a,[y]:F})};if(s.useEffect(()=>{h||(async()=>{try{u(!0);const y=await t();c(y.data)}finally{u(!1)}})()},[t,h]),s.useEffect(()=>{if((a==null?void 0:a.serverTimezoneMinutes)!==void 0){let E=Os(a.serverTimezoneMinutes);p(E)}},[a==null?void 0:a.serverTimezoneMinutes]),r)return e.jsx("p",{children:"Загрузка..."});if(h)return e.jsx("p",{children:"Сохранение настроек..."});if(!a)return e.jsx("p",{children:"Ошибка загрузки страницы."});const m=[{id:1,time:"Пн-Пт 10:00-22:00",currency:"RUB-*"},{id:2,time:"Сб-Вс 13:00-22:00",currency:"RUB-*"}];return e.jsxs(e.Fragment,{children:[e.jsx("h2",{children:"Настройки"}),e.jsxs("label",{className:i.oneLine,children:[e.jsx("input",{type:"checkbox",name:"isExportCourses",checked:a.isExportCourses,onChange:o}),"Экспорт курсов"]}),e.jsxs("label",{className:i.oneLine,children:[e.jsx("input",{type:"checkbox",name:"isMaintenance",checked:a.isMaintenance,onChange:o}),"Режим тех.обслуживания"]}),e.jsx("h3",{children:"Защита от атак"}),e.jsxs("label",{className:i.oneLine,children:[e.jsx("input",{type:"checkbox",name:"isRandomCookie",checked:a.isRandomCookie,onChange:o}),"Включить random-cookie"]}),e.jsxs("label",{className:i.withMargin,children:["Интервал, минут:",e.jsx("input",{type:"number",name:"randomCookieInterval",value:a.randomCookieInterval||"",onChange:o})]}),e.jsxs("label",{className:i.withMargin,children:["Сколько раз разрешено открыть сайт без кук:",e.jsx("input",{type:"number",name:"randomCookieAttempts",value:a.randomCookieAttempts||"",onChange:o})]}),e.jsxs("label",{children:["Таймаут сессии (минут):",e.jsx("input",{type:"number",name:"sessionTimeoutMinutes",value:a.sessionTimeoutMinutes||"",onChange:o})]}),e.jsx("h4",{children:"Максимальное количество запросов в минуту, на каждый IP:"}),e.jsxs("label",{className:i.withMargin,children:["Вход на сайт, создание заявок:",e.jsx("input",{type:"number",name:"maxRequestsSerious",value:a.maxRequestsSerious||"",onChange:o}),e.jsx(oe,{message:(w=a==null?void 0:a.validation)==null?void 0:w.maxRequestsSerious})]}),e.jsxs("label",{className:i.withMargin,children:["Остальные маршруты:",e.jsx("input",{type:"number",name:"maxRequests",value:a.maxRequests||"",onChange:o}),e.jsx(oe,{message:(_=a==null?void 0:a.validation)==null?void 0:_.maxRequests})]}),e.jsx("h3",{style:{marginBottom:"0"},children:"Почта"}),e.jsxs("label",{className:i.withMargin,children:["Сервер:",e.jsx("input",{name:"smtpServer",value:a.smtpServer||"",onChange:o}),e.jsx(oe,{message:(S=a==null?void 0:a.validation)==null?void 0:S.smtpServer})]}),e.jsxs("label",{className:i.withMargin,children:["Порт:",e.jsx("input",{type:"number",name:"smtpPort",value:a.smtpPort||"",onChange:o}),e.jsx(oe,{message:(f=a==null?void 0:a.validation)==null?void 0:f.smtpPort})]}),e.jsxs("label",{className:i.withMargin,children:["Логин:",e.jsx("input",{name:"smtpLogin",value:a.smtpLogin||"",onChange:o}),e.jsx(oe,{message:(v=a==null?void 0:a.validation)==null?void 0:v.smtpLogin})]}),e.jsxs("label",{className:i.withMargin,children:["Пароль:",e.jsx("input",{name:"smtpPassword",value:a.smtpPassword||"",onChange:o}),e.jsx(oe,{message:(k=a==null?void 0:a.validation)==null?void 0:k.smtpPassword})]}),e.jsx("h3",{style:{marginBottom:"0"},children:"Часовой пояс"}),e.jsx($,{rows:Ne,setSelectedId:p,selectedId:j}),e.jsx(oe,{message:(N=a==null?void 0:a.validation)==null?void 0:N.serverTimezoneMinutes}),e.jsxs("label",{className:i.oneLine,children:["Текущее время: ",e.jsx(Fs,{serverTimezoneOffset:a.serverTimezoneMinutes}),e.jsx("br",{})]}),e.jsx("h3",{children:"Расписание валют"}),e.jsx("button",{style:{margin:"0 0 0.5em 0"},onClick:()=>{b(M.EDIT_TIMETABLE)},children:"Добавить.."}),e.jsx(ks,{data:m,rowsSelected:d,setRowsSelected:C}),d.length>0&&e.jsx(Ps,{rowsSelected:d}),e.jsx("button",{id:"save",onClick:I,children:"Сохранить"})]});async function I(){const E={...a,serverTimezoneMinutes:parseInt(Rs(j))};c(E),l(!0);try{let y=await n({opt:E});A.info(y.message)}finally{l(!1)}}}const Ps=({rowsSelected:t})=>e.jsxs("div",{className:i.actionButtons,children:[e.jsxs("p",{children:["Выбрано ",t.length," элементов."]}),e.jsx("button",{children:"Удалить"})]}),$n=Object.freeze(Object.defineProperty({__proto__:null,default:Ls},Symbol.toStringTag,{value:"Module"}));function Us(){const{id:t}=le(),n=[{id:1,name:"Код валюты"},{id:2,name:"Название валюты"}],[a,c]=s.useState(1),[r,u]=s.useState(1),{currencies:h,loading:l}=s.useContext(se),j=[...h.map(d=>d.name),"Все валюты"],p=Ds("ru-RU"),b=[...h.map(d=>d.code).reduce((d,C)=>(d.some(m=>m===C)||d.push(C),d),[]),"Все валюты"];return l?e.jsx("h2",{children:"Загрузка..."}):e.jsxs(e.Fragment,{children:[e.jsx(Ms,{id:t}),e.jsxs("div",{className:[i.tableTwoColLayout,i.editTimetable].join(" "),children:[e.jsxs("label",{children:[e.jsx("b",{children:"Отдаю:"}),e.jsx($,{rows:n,setRows:c}),e.jsx(ae,{rows:a==1?b:j,className:i.checkboxList})]}),e.jsxs("label",{children:[e.jsx("b",{children:"Получаю:"}),e.jsx($,{rows:n,setRows:u}),e.jsx(ae,{rows:r==1?b:j,className:i.checkboxList})]}),e.jsxs("div",{children:[e.jsxs("label",{children:[e.jsx("b",{style:{marginRight:"0"},children:"С:"})," ",e.jsx("input",{type:"time"})]}),e.jsxs("label",{children:[e.jsx("b",{style:{marginRight:"0"},children:"до:"})," ",e.jsx("input",{type:"time"})]}),e.jsx(ae,{rows:p,className:i.checkboxList})]})]}),e.jsx("button",{className:i.save,children:"Сохранить"})]})}function Ms({id:t}){return t?e.jsxs("h2",{children:["Редактировать расписание - ",t]}):e.jsx("h2",{children:"Добавить расписание"})}const Ds=t=>{const n=new Intl.DateTimeFormat(t,{weekday:"long"}),a=[],c=new Date,r=c.getDay(),u=(r===0?-6:1)-r;c.setDate(c.getDate()+u);for(let h=0;h<7;h++)a.push(n.format(c)),c.setDate(c.getDate()+1);return a},An=Object.freeze(Object.defineProperty({__proto__:null,default:Us},Symbol.toStringTag,{value:"Module"})),$s=({data:t,rowsSelected:n,setRowsSelected:a,isCanEdit:c,roles:r,defaultCashback:u})=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:i.checkboxContainer,children:[e.jsx("input",{type:"checkbox",id:t.id,checked:n.includes(t.id),disabled:!c,onChange:()=>{n.includes(t.id)?a(n.filter(h=>h!==t.id)):a([...n,t.id])}}),e.jsxs("span",{children:[e.jsx("label",{htmlFor:t.id,children:t.name}),c&&e.jsx(ie,{className:i.links,to:`${M.EDIT_USER}/${t.id}`,children:"Редактировать.."})]})]}),e.jsx("div",{children:new Date(t.date).toLocaleString()}),e.jsx("div",{children:t.mail}),e.jsx("div",{children:r.find(h=>h.id==t.roleId).name}),e.jsxs("div",{children:[t.cashbackPercent||u,"% "]}),e.jsx("div",{children:t.ordersCount})]}),As=({data:t,rowsSelected:n,setRowsSelected:a,defaultCashback:c})=>{const{roles:r,activeRole:u}=s.useContext(Q);return e.jsxs("div",{className:i.tableSixCol,children:[e.jsx("div",{children:"Имя"}),e.jsx("div",{children:"Дата регистрации"}),e.jsx("div",{children:"Почта"}),e.jsx("div",{children:"Роль"}),e.jsx("div",{children:"Кэшбек"}),e.jsx("div",{children:"Обмены"}),t.map((h,l)=>e.jsx($s,{data:h,rowsSelected:n,setRowsSelected:a,isCanEdit:u.isEditUserAndRole,roles:r,defaultCashback:c},l)),e.jsx(ue,{items:t,rowsSelected:n,setRowsSelected:a})]})};function Bs(){const{loading:t,roles:n,activeRole:a}=s.useContext(Q),{fetchUsers:c,deleteUsers:r,fetchOptions:u}=s.useContext(V),h=J(),[l,j]=s.useState(!0),[p,b]=s.useState([]),[d,C]=s.useState([]),[o,m]=s.useState(0),[I,w]=s.useState(0),_=10,[S,f]=s.useState(""),[v,k]=s.useState(!1),[N,E]=s.useState(),[y,T]=s.useState(!0),[R,F]=s.useState(),L=async()=>{try{j(!0);const B=o*_,[q,K]=await Promise.all([c({start:B,count:_,query:S,roleId:N}).then(X=>X.data),u().then(X=>X.data)]);b(q.items),w(q.total),F(K)}finally{j(!1)}},P=async()=>{f(""),E(null),o===0?T(!y):m(0)},g=async()=>{o===0?L():m(0)};s.useEffect(()=>{L()},[o,y]);const D=async()=>{try{k(!0);const B=await r({ids:d});C([]),A.info(B.message),L()}finally{k(!1)}},W=({rowsSelected:B})=>e.jsxs("div",{className:i.actionButtons,children:[e.jsxs("p",{children:["Выбрано ",B.length," элементов."]}),e.jsx("button",{onClick:D,children:"Удалить"})]});return l||t?e.jsx("p",{children:"Загрузка..."}):v?e.jsx("p",{children:"Удаление..."}):e.jsxs(e.Fragment,{children:[e.jsx("h2",{children:"Пользователи"}),a.isEditUserAndRole&&e.jsx("button",{className:i.addButton,onClick:()=>{h(M.EDIT_USER)},children:"Добавить.."}),e.jsxs("div",{className:i.tableTwoColLayout,children:[e.jsx("label",{htmlFor:"filter",children:"Фильтр:"}),e.jsx("input",{id:"filter",placeholder:"Имя или почта",value:S,onChange:B=>f(B.target.value)}),e.jsx("label",{htmlFor:"role",children:"Роль:"}),e.jsx($,{id:"role",rows:[{id:null,name:"Все роли"},...n],selectedId:N,setSelectedId:E}),e.jsx("button",{onClick:P,children:"Сброс"}),e.jsx("button",{onClick:g,children:"Применить фильтр"})]}),e.jsx(As,{data:p,rowsSelected:d,setRowsSelected:C,defaultCashback:R.cashbackPercent}),d.length>0&&e.jsx(W,{rowsSelected:d}),e.jsx(H,{total:I,currentPage:o,rowsPerPage:_,onPageChange:m,className:i.pagination})]})}const Bn=Object.freeze(Object.defineProperty({__proto__:null,default:Bs},Symbol.toStringTag,{value:"Module"}));function zs(){var S;const{id:t}=le(),{roles:n,loading:a}=s.useContext(Q),{sendUser:c,fetchUserInfo:r,fetchOptions:u}=s.useContext(V),h={name:"",mail:"",password:"",roleId:((S=n==null?void 0:n.at(-1))==null?void 0:S.id)||0},[l,j]=s.useState({}),[p,b]=s.useState(!1),[d,C]=s.useState(h),o=J(),[m,I]=s.useState(!0);if(s.useEffect(()=>{t?(async()=>{try{const[v,k]=await Promise.all([await r({userId:t}).then(N=>N.data),await u().then(N=>N.data)]);C(v),j(k)}finally{I(!1)}})():I(!1)},[]),m||a)return e.jsx("p",{children:"Загрузка..."});if(p)return e.jsx("p",{children:"Сохранение..."});const w=async()=>{try{b(!0);const f=await c({user:d});A.info(f.message),o(M.USERS)}finally{b(!1)}},_=f=>{var N,E;const v=((N=f==null?void 0:f.target)==null?void 0:N.name)||f.name,k=((E=f==null?void 0:f.target)==null?void 0:E.value)||f.value;C(y=>({...y,[v]:k}))};return e.jsxs(e.Fragment,{children:[e.jsx(Gs,{id:t,name:d==null?void 0:d.name}),e.jsxs("div",{className:[i.tableTwoColLayout,i.editUser].join(" "),children:[e.jsx("label",{htmlFor:"userName",children:"Имя:"}),e.jsx("input",{id:"userName",name:"name",value:(d==null?void 0:d.name)||"",onChange:_}),e.jsx("label",{htmlFor:"password",children:"Пароль:"}),e.jsx("input",{id:"password",name:"password",type:"password",value:(d==null?void 0:d.password)||"",onChange:_}),e.jsx("label",{htmlFor:"mail",children:"Почта:"}),e.jsx("input",{id:"mail",name:"mail",value:(d==null?void 0:d.mail)||"",onChange:_}),e.jsx("label",{htmlFor:"role",children:"Роль:"}),e.jsx($,{id:"role",rows:n,selectedId:d.roleId,setSelectedId:f=>C({...d,roleId:f})}),e.jsx("label",{htmlFor:"cashbackPercent",children:"Кэшбэк:"}),e.jsx("input",{id:"cashbackPercent",name:"cashbackPercent",value:(d==null?void 0:d.cashbackPercent)||l.cashbackPercent,onChange:_}),e.jsx("label",{htmlFor:"cashbackType",children:"Тип кэшбэка:"}),e.jsx($,{id:"cashbackType",rows:Se,selectedId:(d==null?void 0:d.cashbackType)||l.cashbackType,setSelectedId:f=>C({...d,cashbackType:f})}),e.jsx("label",{htmlFor:"referralPercent",children:"Реферальный процент:"}),e.jsx("input",{id:"referralPercent",name:"referralPercent",value:(d==null?void 0:d.referralPercent)||l.referralPercent,onChange:_}),e.jsx("label",{htmlFor:"referralType",children:"Тип реф.программы:"}),e.jsx($,{id:"referralType",rows:Se,selectedId:(d==null?void 0:d.referralType)||l.referralType,setSelectedId:f=>C({...d,referralType:f})}),e.jsx("label",{children:"Реферал:"}),d!=null&&d.referralId?e.jsxs("p",{children:[d==null?void 0:d.referralName," | ",d==null?void 0:d.referralMail]}):e.jsx("p",{children:"Не задан"})]}),e.jsx("button",{className:i.save,onClick:w,children:"Сохранить"})]})}function Gs({id:t,name:n}){return t?e.jsxs("h2",{children:["Редактировать пользователя ",n]}):e.jsx("h2",{children:"Добавить пользователя"})}const zn=Object.freeze(Object.defineProperty({__proto__:null,default:zs},Symbol.toStringTag,{value:"Module"}));function Vs(){const{roles:t,setRoles:n,loading:a,activeRole:c}=s.useContext(Q),{deleteRoles:r}=s.useContext(V),[u,h]=s.useState([]),[l,j]=s.useState(!1),p=J();if(a||!c)return e.jsx("p",{children:"Загрузка..."});if(l)return e.jsx("p",{children:"Удаление..."});function b(){return e.jsx("ul",{className:[i.checkboxList,i.rolesList].join(" "),children:t.map((m,I)=>e.jsx(d,{row:m},I))})}const d=({row:m})=>e.jsxs("li",{children:[e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",value:m.id,id:m.id,checked:u.includes(m.id),onChange:()=>{u.includes(m.id)?h(u.filter(I=>I!==m.id)):h([...u,m.id])}}),m.name]}),c.isEditUserAndRole&&e.jsx("div",{style:{marginLeft:"1.5em"},children:e.jsx(ie,{className:i.links,to:`${M.EDIT_ROLE}/${m.id}`,children:"Редактировать.."})})]}),C=async()=>{try{j(!0);const m=await r({ids:u});h([]),n(t.filter(I=>!u.includes(I.id))),A.info(m.message)}finally{j(!1)}},o=({rowsSelected:m})=>e.jsxs("div",{className:i.actionButtons,children:[e.jsxs("p",{children:["Выбрано ",m.length," элементов."]}),e.jsx("button",{onClick:C,children:"Удалить"})]});return e.jsxs(e.Fragment,{children:[e.jsx("h2",{children:"Роли"}),c&&e.jsx("button",{className:i.addButton,onClick:()=>{p(M.EDIT_ROLE)},children:"Добавить.."}),e.jsx(b,{}),u.length>0&&e.jsx(o,{rowsSelected:u})]})}const Gn=Object.freeze(Object.defineProperty({__proto__:null,default:Vs},Symbol.toStringTag,{value:"Module"}));function Ws(){const{id:t}=le(),{roles:n,setRoles:a,setActiveRole:c}=s.useContext(Q),[r,u]=s.useState(!1),{sendRole:h}=s.useContext(V),[l,j]=s.useState(),[p,b]=s.useState([]),d=[{id:"isAdminPanel",name:"Доступ в админку"},{id:"isEditUserAndRole",name:"Менять список пользователей и роли"},{id:"isEditNews",name:"Добавлять новости"},{id:"isEditOptions",name:"Редактировать настройки"},{id:"isEditCurrency",name:"Редактировать валюты"},{id:"isEditDirection",name:"Редактировать направления обмена"},{id:"isEditReserve",name:"Указывать резерв"},{id:"isEditNotify",name:"Редактировать уведомления"},{id:"isEditReview",name:"Работать с отзывами"},{id:"isSendReferralPayouts",name:"Подтверждать выплаты бонусов"}],C=J();if(s.useEffect(()=>{if(n)if(t){const m=n.find(w=>w.id==t);j(m);const I=d.filter(w=>m==null?void 0:m[w.id]).map(w=>w.id);b(I)}else j({name:""})},[t,n]),r)return e.jsx("p",{children:"Сохранение..."});if(!l)return e.jsx("p",{children:"Загрузка..."});const o=async()=>{try{u(!0);let m={name:l.name,...parseInt(t)?{id:parseInt(t)}:{}};p.forEach(w=>m[w]=!0);const I=await h({role:m});a(w=>{const _=[...w],S=w.findIndex(k=>k.id==m.id);S!=-1?_[S]=m:_.push({...m,id:I.data.id});const f=localStorage.getItem("activeRoleId"),v=_.find(k=>k.id===parseInt(f));return c(v),_}),A.info(I.message),C(M.ROLES)}finally{u(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx(Ks,{id:t,roleName:l.name}),e.jsxs("label",{children:["Название роли:",e.jsx("input",{value:l.name,onChange:m=>j({...l,name:m.target.value})})]}),e.jsx("p",{children:"Права:"}),e.jsx(ae,{rows:d,checkedKeys:p,onCheckChange:b,className:i.checkboxList}),e.jsx("button",{className:i.save,onClick:o,children:"Сохранить"})]})}function Ks({id:t,roleName:n}){return t?e.jsxs("h2",{children:["Редактировать роль - ",n]}):e.jsx("h2",{children:"Создать роль"})}const Vn=Object.freeze(Object.defineProperty({__proto__:null,default:Ws},Symbol.toStringTag,{value:"Module"})),Ys=({data:t,rowsSelected:n,setRowsSelected:a})=>{var c;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:i.checkboxContainer,children:[e.jsx("input",{id:t.id,type:"checkbox",checked:n.includes(t.id),onChange:()=>{n.includes(t.id)?a(n.filter(r=>r!==t.id)):a([...n,t.id])}}),e.jsxs("span",{children:[e.jsx("label",{htmlFor:t.id,children:new Date(t.date).toLocaleString()}),e.jsx("p",{className:i.links,children:e.jsx(ie,{to:`${M.EDIT_REVIEW}/${t.id}`,children:"Редактировать.."})})]})]}),e.jsxs("div",{children:[t.caption," | ",t.mail]}),e.jsx("div",{children:t.text}),e.jsxs("div",{children:[e.jsx(He,{value:t==null?void 0:t.rating,size:20,disabled:!0}),e.jsx("div",{style:{paddingTop:0},children:((c=we.find(r=>r.id==t.status))==null?void 0:c.name)||t.status})]})]})},Qs=({data:t,rowsSelected:n,setRowsSelected:a})=>e.jsxs("div",{className:i.tableFourCol,children:[e.jsx("div",{children:"Дата"}),e.jsx("div",{children:"Имя | Почта"}),e.jsx("div",{children:"Текст"}),e.jsx("div",{children:"Оценка | Статус"}),t==null?void 0:t.map(c=>e.jsx(Ys,{data:c,rowsSelected:n,setRowsSelected:a},c.id))]});function Qe({rows:t,selectedId:n,setSelectedId:a,name:c}){const r=u=>{a&&a(c?{name:c,value:u.target.value}:u.target.value)};return e.jsx("select",{onChange:r,value:n??void 0,children:t.map(u=>e.jsx("option",{value:u.id??u,children:u.name??u},u.id??u))})}function Xs(){const[t,n]=s.useState([]),[a,c]=s.useState(!0),[r,u]=s.useState(!1),[h,l]=s.useState(),{fetchReviews:j,sendReview:p}=s.useContext(V),[b,d]=s.useState(),[C,o]=s.useState(0),[m,I]=s.useState(!1),w=10,[_,S]=s.useState({}),f=y=>{var F,L;const T=((F=y==null?void 0:y.target)==null?void 0:F.name)||y.name,R=((L=y==null?void 0:y.target)==null?void 0:L.value)||y.value;S(P=>({...P,[T]:R}))},v=async()=>{var y,T;try{c(!0);const R=C*w;let F=_.status==="Все"?Te(_,"status"):_;F=F.rating=="Все"?Te(F,"rating"):F;let L=await j({...F,start:R,count:w,textSize:15,dateStart:(y=_.dateStart)==null?void 0:y.concat("T00:00"),dateEnd:(T=_.dateEnd)==null?void 0:T.concat("T00:00")});d(L.data.total),l(L.data.items)}finally{c(!1)}},k=async y=>{try{u(!0),await Promise.all(t.map(T=>p({review:{id:T,status:y}}))),A.info("Статус обновлен")}finally{n([]),u(!1),v()}},N=({rowsSelected:y})=>e.jsxs("div",{className:i.actionButtons,children:[e.jsxs("p",{children:["Выбрано ",y.length," отзывов."]}),e.jsx("button",{onClick:()=>k("approved"),children:"Опубликовать"}),e.jsx("button",{onClick:()=>k("moderation"),children:"На модерацию"}),e.jsx("button",{onClick:()=>k("banned"),children:"Забанить"}),e.jsx("button",{onClick:()=>k("deleted"),children:"Удалить"})]}),E=()=>{C==0?v():o(0)};return s.useEffect(()=>{v()},[C]),a?e.jsx("p",{children:"Загрузка..."}):r?e.jsx("p",{children:"Сохранение..."}):e.jsxs(e.Fragment,{children:[e.jsx("h2",{children:"Список отзывов"}),e.jsx(me,{title:"Фильтр",isVisible:m,setIsVisible:I,styles:i,child:e.jsxs("div",{className:i.tableOrders,children:[e.jsxs("div",{children:[e.jsxs("label",{children:["Дата от: ",e.jsx("input",{type:"date",value:_==null?void 0:_.dateStart,name:"dateStart",onChange:f})]}),e.jsxs("label",{children:["Дата до: ",e.jsx("input",{type:"date",value:_==null?void 0:_.dateEnd,name:"dateEnd",onChange:f})]})]}),e.jsxs("label",{children:["Имя пользователя:",e.jsx("input",{name:"userName",value:_==null?void 0:_.userName,onChange:f})]}),e.jsxs("label",{children:["Почта:",e.jsx("input",{name:"userMail",value:_==null?void 0:_.userMail,onChange:f})]}),e.jsxs("label",{children:["Статус:",e.jsx(Qe,{name:"status",rows:["Все",...we],selectedId:_==null?void 0:_.status,setSelectedId:f})]}),e.jsxs("label",{children:["Оценка:",e.jsx(Qe,{name:"rating",rows:["Все","1","2","3","4","5"],selectedId:_==null?void 0:_.rating,setSelectedId:f})]}),e.jsxs("label",{children:["Текст:",e.jsx("input",{name:"text",value:_==null?void 0:_.text,onChange:f})]}),e.jsx("button",{onClick:E,children:"Применить фильтр"})]})}),h.length>0?e.jsxs(e.Fragment,{children:[e.jsx(Qs,{data:h,rowsSelected:t,setRowsSelected:n}),e.jsx(H,{total:b,currentPage:C,rowsPerPage:w,onPageChange:o,className:i.pagination})]}):"Нет отзывов",t.length>0&&e.jsx(N,{rowsSelected:t})]})}const Wn=Object.freeze(Object.defineProperty({__proto__:null,default:Xs},Symbol.toStringTag,{value:"Module"}));function Hs(){const{id:t}=le(),[n,a]=s.useState([]),[c,r]=s.useState(!0),[u,h]=s.useState(!1),[l,j]=s.useState(),{fetchReview:p,sendReview:b}=s.useContext(V),d=async()=>{try{r(!0);let o=await p({id:t});j(o.data)}finally{r(!1)}},C=async()=>{try{h(!0);let o=await b({review:l});A.info(o.message)}finally{h(!1)}};return s.useEffect(()=>{d()},[]),c?e.jsx("p",{children:"Загрузка..."}):u?e.jsx("p",{children:"Сохранение..."}):e.jsxs(e.Fragment,{children:[e.jsxs("h2",{children:["Редактировать отзыв ",t]}),e.jsxs("div",{className:i.tableTwoColLayout,children:[e.jsx("div",{children:"Дата:"}),(l==null?void 0:l.date)&&new Date(l==null?void 0:l.date).toLocaleString(),e.jsx("div",{children:"Имя:"}),l==null?void 0:l.caption,e.jsx("label",{htmlFor:"mail",children:"Почта:"}),l==null?void 0:l.mail,e.jsx("label",{htmlFor:"review",children:"Текст отзыва:"}),e.jsx("textarea",{rows:"10",cols:"40",id:"review",value:l==null?void 0:l.text,onChange:o=>j({...l,text:o.target.value})}),e.jsx("label",{htmlFor:"status",children:"Статус:"}),e.jsx($,{id:"status",rows:we,selectedId:l==null?void 0:l.status,setSelectedId:o=>j({...l,status:o})}),e.jsx("label",{htmlFor:"rating",children:"Оценка:"}),e.jsx(He,{id:"rating",value:l==null?void 0:l.rating,onChange:o=>j({...l,rating:o}),size:30}),e.jsx("button",{className:i.save,style:{marginTop:"2em"},onClick:C,children:"Сохранить"})]})]})}const Kn=Object.freeze(Object.defineProperty({__proto__:null,default:Hs},Symbol.toStringTag,{value:"Module"}));function Zs(){const[t,n]=s.useState([]),[a,c]=s.useState([]),[r,u]=s.useState(!0),[h,l]=s.useState(!1),[j,p]=s.useState(0),[b,d]=s.useState(0),[C,o]=s.useState(!1),m=10,I=J(),{fetchNews:w}=s.useContext(he),{deleteNews:_}=s.useContext(V),{activeRole:S,loading:f}=s.useContext(Q);if(s.useEffect(()=>{(async()=>{try{const T=j*m,R=(await w({start:T,count:m})).data;d(R.total),n(R.items)}finally{u(!1)}})()},[j,C]),r||f||!S)return e.jsx("p",{children:"Загрузка..."});if(h)return e.jsx("p",{children:"Удаление..."});const v=async()=>{try{l(!0);const y=await _({ids:a});c([]),o(!C),A(y.message)}finally{l(!1)}},k=({data:y})=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:i.checkboxContainer,children:[e.jsx("input",{id:y.id,type:"checkbox",checked:a.includes(y.id),disabled:!S.isEditNews,onChange:()=>{a.includes(y.id)?c(a.filter(T=>T!==y.id)):c([...a,y.id])}}),e.jsxs("span",{children:[e.jsx("label",{htmlFor:y.id,children:new Date(y.date).toLocaleString()}),e.jsx("p",{className:i.links,children:e.jsx(ie,{to:`${M.EDIT_NEWS}/${y.id}`,children:S.isEditNews?"Редактировать..":"Просмотреть..."})})]})]}),e.jsx("div",{children:y.caption})]}),N=({data:y})=>e.jsxs("div",{className:i.tableTwoCol,children:[e.jsx("div",{children:"Дата"}),e.jsx("div",{children:"Заголовок"}),y.map(T=>e.jsx(k,{data:T,rowsSelected:a,setRowsSelected:c},T.id)),e.jsx(ue,{items:y,rowsSelected:a,setRowsSelected:c})]}),E=()=>e.jsxs("div",{className:i.actionButtons,children:[e.jsxs("p",{children:["Выбрано ",a.length," элементов."]}),e.jsx("button",{onClick:v,children:"Удалить"})]});return e.jsxs(e.Fragment,{children:[e.jsx("h2",{children:"Новости"}),S.isEditNews&&e.jsx("button",{className:i.addButton,onClick:()=>{I(M.EDIT_NEWS)},children:"Добавить.."}),e.jsx(N,{data:t}),e.jsx(H,{total:b,currentPage:j,rowsPerPage:m,onPageChange:p,className:i.pagination}),a.length>0&&e.jsx(E,{})]})}const Yn=Object.freeze(Object.defineProperty({__proto__:null,default:Zs},Symbol.toStringTag,{value:"Module"}));function Js(){const{id:t}=le(),[n,a]=s.useState({caption:"",text:""}),[c,r]=s.useState(t),[u,h]=s.useState(!1),{fetchNewsRecord:l}=s.useContext(he),{sendNews:j}=s.useContext(V),{activeRole:p,loading:b}=s.useContext(Q),d=J(),C=async()=>{try{h(!0);const m={...parseInt(t)?{id:parseInt(t)}:{},...n},I=await j({news:m});A.info(I.message),d(M.NEWS)}finally{h(!1)}};if(s.useEffect(()=>{t&&(async()=>{try{const I=(await l({id:t})).data;a(I)}finally{r(!1)}})()},[]),c||b)return e.jsx("p",{children:"Загрузка..."});if(u)return e.jsx("p",{children:"Сохранение..."});const o=p.isEditNews?"Редактировать":"Просмотреть";return e.jsxs(e.Fragment,{children:[t?e.jsxs("h2",{children:[o," новость"]}):e.jsx("h2",{children:"Создать новость"}),e.jsx("div",{children:e.jsx("input",{style:{width:"70%"},value:n.caption,onChange:m=>a({...n,caption:m.target.value}),disabled:!p.isEditNews})}),e.jsx("div",{children:e.jsx("textarea",{rows:"10",cols:"40",style:{width:"70%"},value:n.text,onChange:m=>a({...n,text:m.target.value}),disabled:!p.isEditNews})}),p.isEditNews&&e.jsx("button",{className:i.save,onClick:C,children:"Сохранить"})]})}const Qn=Object.freeze(Object.defineProperty({__proto__:null,default:Js},Symbol.toStringTag,{value:"Module"})),pe=({exchangeName:t,isShowApiKey:n,isShowSecretKey:a})=>{const{fetchExchange:c,sendExchange:r,updateCourses:u}=s.useContext(V),[h,l]=s.useState(!0),[j,p]=s.useState(!1),[b,d]=s.useState(!1),[C,o]=s.useState(),[m,I]=s.useState(),w=f=>{const{name:v,type:k,checked:N,value:E}=f.target;o(y=>({...y,[v]:k==="checkbox"?N:E}))},_=async()=>{try{p(!0);let f=C;m.trim().length>0?f.blacklist=m.split(",").map(k=>k.trim()):f.blacklist=[];const v=await r({exchange:f});A.info(v.message)}finally{p(!1)}},S=async()=>{try{l(!0);const f=await u({exchangeName:t});d(!0),A.info(f.message)}finally{l(!1)}};return s.useEffect(()=>{(async()=>{try{const v=(await c({exchangeName:t})).data;o(v),I(v.blacklist.join(","))}finally{l(!1),d(!1)}})()},[b]),h?e.jsx("p",{children:"Загрузка..."}):j?e.jsx("p",{children:"Сохранение..."}):e.jsxs(e.Fragment,{children:[e.jsx("h2",{children:t}),e.jsxs("div",{className:i.container,children:[e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",name:"isEnabled",checked:C.isEnabled,onChange:w}),"Включить"]}),e.jsxs("div",{className:i.horzList,children:["URL:",e.jsx("input",{name:"url",value:C.url,onChange:w})]}),e.jsxs("div",{className:i.horzList,children:["Черный список валют:",e.jsx("input",{name:"blacklist",placeholder:"через запятую",value:m,onChange:f=>I(f.target.value)})]}),e.jsxs("div",{className:i.horzList,children:["Запрашивать курсы каждые",e.jsx("input",{name:"updatePeriod",value:C.updatePeriod,onChange:w,type:"number",min:"1"}),"минут"]}),e.jsxs("div",{className:i.horzList,children:["Макс.количество ошибок подряд:",e.jsx("input",{name:"maxFailCount",value:C.maxFailCount,onChange:w,type:"number",min:"0"})]}),"Последнее обновление: ",new Date(C.lastUpdate).toLocaleString(),e.jsx("br",{}),n&&e.jsxs("label",{className:i.horzList,children:["API-ключ: ",e.jsx("input",{name:"apiKey",value:C.apiKey,onChange:w,autoComplete:"off"})]}),a&&e.jsxs("label",{className:i.horzList,children:["Секретный ключ: ",e.jsx("input",{name:"secretKey",value:C.secretKey,onChange:w,autoComplete:"off"})]}),e.jsxs("div",{className:i.actionButtons,children:[e.jsx("button",{className:i.save,onClick:_,children:"Сохранить"}),e.jsx("button",{onClick:S,children:"Обновить сейчас"})]})]})]})};function qs(){return e.jsx(pe,{exchangeName:"CoinMarketCap",isShowApiKey:!0})}const Xn=Object.freeze(Object.defineProperty({__proto__:null,default:qs},Symbol.toStringTag,{value:"Module"}));function en(){return e.jsx(pe,{exchangeName:"Bybit",isShowApiKey:!0,isShowSecretKey:!0})}const Hn=Object.freeze(Object.defineProperty({__proto__:null,default:en},Symbol.toStringTag,{value:"Module"}));function tn(){return e.jsx(pe,{exchangeName:"Garantex"})}const Zn=Object.freeze(Object.defineProperty({__proto__:null,default:tn},Symbol.toStringTag,{value:"Module"}));function sn(){return e.jsx(pe,{exchangeName:"Binance"})}const Jn=Object.freeze(Object.defineProperty({__proto__:null,default:sn},Symbol.toStringTag,{value:"Module"}));function nn(){return e.jsx(pe,{exchangeName:"Cbr"})}const qn=Object.freeze(Object.defineProperty({__proto__:null,default:nn},Symbol.toStringTag,{value:"Module"}));function an(){return e.jsx(pe,{exchangeName:"Mexc",isShowApiKey:!0,isShowSecretKey:!0})}const ea=Object.freeze(Object.defineProperty({__proto__:null,default:an},Symbol.toStringTag,{value:"Module"})),ln=({data:t,rowsSelected:n,setRowsSelected:a,activeRole:c})=>{const r=`${t.from} -> ${t.to}`;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:i.checkboxContainer,children:[e.jsx("input",{type:"checkbox",id:t.id,checked:n.includes(t.id),onChange:()=>{n.includes(t.id)?a(n.filter(u=>u!==t.id)):a([...n,t.id])}}),e.jsxs("span",{children:[e.jsx("label",{htmlFor:t.id,children:r}),e.jsx("p",{className:i.links,children:e.jsx(ie,{to:`${M.EDIT_FORMULA}/${t.from}-${t.to}`,children:c!=null&&c.isEditCurrency?"Редактировать..":"Просмотреть.."})})]})]}),e.jsx("div",{children:t.tag}),e.jsx("div",{children:t.price}),e.jsx("div",{children:t.isEnabled?"Активна":"Отключена"})]})},rn=({data:t,rowsSelected:n,setRowsSelected:a})=>{const{activeRole:c}=s.useContext(Q);return e.jsxs("div",{className:i.tableFourCol,children:[e.jsx("div",{children:"Название"}),e.jsx("div",{children:"Формула"}),e.jsx("div",{children:"Курс"}),e.jsx("div",{children:"Статус"}),t.map((r,u)=>e.jsx(ln,{data:r,rowsSelected:n,setRowsSelected:a,activeRole:c},u)),e.jsx(ue,{items:t,rowsSelected:n,setRowsSelected:a})]})};function cn(){const{fetchFormulas:t,deleteFormulas:n,sendFormula:a}=s.useContext(V),{activeRole:c,loading:r}=s.useContext(Q),u=J(),h=100,[l,j]=s.useState(0),[p,b]=s.useState([]),[d,C]=s.useState(0),[o,m]=s.useState([]),[I,w]=s.useState(!1),[_,S]=s.useState(),[f,v]=s.useState(),[k,N]=s.useState(!0),[E,y]=s.useState(!1);s.useEffect(()=>{const g=async()=>{N(!0);try{const D=l*h,W=(await t({start:D,count:h,status:_=="all"?void 0:_,filter:f==""?void 0:f})).data;b(W.items),C(W.total)}finally{N(!1)}};I&&(g(),w(!1)),g()},[l,I]);const T=[{id:"all",name:"Все"},{id:"active",name:"Активные"},{id:"inactive",name:"Отключенные"}],R=()=>{j(0),w(!0)},F=async()=>{try{y(!0);const g=await n({ids:o});b([...p.filter(D=>!o.includes(D.id))]),m([]),A.info(g.message)}finally{y(!1)}},L=async g=>{try{y(!0);let D=[...p];const W=o.map(async K=>{const X=p.find(Y=>Y.id==K);if(X){const Y={...X,isEnabled:g};return await a({formula:Y}),D=D.map(x=>x.id===K?Y:x),`${X.from} -> ${X.to}`}return null}),B=(await Promise.all(W)).filter(Boolean);m([]),b(D),A(`Формулы ${g?"включены":"отключены"}: ${B}`)}finally{y(!1)}},P=()=>e.jsxs("div",{className:i.actionButtons,children:[e.jsxs("p",{children:["Выбрано ",o.length," элементов."]}),e.jsx("button",{onClick:()=>L(!0),children:"Активировать"}),e.jsx("button",{onClick:()=>L(!1),children:"Деактивировать"}),e.jsx("button",{onClick:F,children:"Удалить"})]});return k||r?e.jsx("p",{children:"Загрузка..."}):E?e.jsx("p",{children:"Сохранение..."}):e.jsxs(e.Fragment,{children:[e.jsx("h2",{children:"Формулы"}),c.isEditCurrency&&e.jsx("button",{className:i.addButton,onClick:()=>{u(M.EDIT_FORMULA)},children:"Добавить.."}),e.jsxs("div",{className:i.horzList,children:["Статус: ",e.jsx($,{rows:T,setSelectedId:S})]}),e.jsxs("div",{className:i.horzList,children:[e.jsxs("label",{children:["Фильтр: ",e.jsx("input",{value:f,placeholder:"Код валюты или формула",onChange:g=>v(g.target.value)})]}),e.jsx("button",{onClick:R,children:"Применить"})]}),e.jsx(H,{total:d,currentPage:l,rowsPerPage:h,onPageChange:j,className:i.pagination}),e.jsx(rn,{data:p,rowsSelected:o,setRowsSelected:m}),o.length>0&&e.jsx(P,{rowsSelected:o}),e.jsx(H,{total:d,currentPage:l,rowsPerPage:h,onPageChange:j,className:i.pagination}),e.jsxs("p",{children:["Найдено формул: ",d]})]})}const ta=Object.freeze(Object.defineProperty({__proto__:null,default:cn},Symbol.toStringTag,{value:"Module"}));function on(){const{id:t}=le(),{activeRole:n,loading:a}=s.useContext(Q),[c,r]=(t==null?void 0:t.split("-"))||[void 0,void 0],{currencies:u,loading:h}=s.useContext(se),l=Array.from(new Set(u.map(z=>z.code))),{fetchFormulaVariants:j,sendFormula:p}=s.useContext(V),{fetchFormula:b}=s.useContext(he),d=[{id:"auto",name:"Авто"},{id:"CoinMarketCap",name:"CoinMarketCap"},{id:"fromFile",name:"Из файла"}],C=[{id:"auto",name:"Найти новый курс (Авто)"},{id:"CoinMarketCap",name:"Переключить на CoinMarketCap"},{id:"off",name:"Отключить"}],[o,m]=s.useState("auto"),[I,w]=s.useState("auto"),[_,S]=s.useState(),[f,v]=s.useState(),[k,N]=s.useState(!1),[E,y]=s.useState(!1),[T,R]=s.useState(!1),[F,L]=s.useState(),[P,g]=s.useState({auto:null,fromFile:null,coinMarketCap:null}),[D,W]=s.useState(),B=async()=>{var z;R(!0);try{g(Z=>({...Z,[o]:null}));const U=(await j({from:_,to:f,searchCase:o})).data;g(Z=>({...Z,[o]:U})),o==="auto"&&(console.log("Setting selected variant..."),W((z=U.list[0])==null?void 0:z.path))}finally{R(!1)}};s.useEffect(()=>{t&&!E?(async()=>{N(!0);try{const U=(await b({from:c,to:r})).data;L(U),S(c),v(r),w(U.reserve)}finally{N(!1)}})():(S(l[0]),v(l[1]))},[E]);const q=()=>{var z,U,Z,ce;return e.jsxs(e.Fragment,{children:[t&&e.jsx("h3",{children:"Новая формула"}),e.jsxs("div",{className:i.horzList,children:["Курс:",e.jsx($,{rows:d,selectedId:o,setSelectedId:m}),e.jsx("button",{onClick:B,children:"Найти курс"})]}),o==="auto"&&(P==null?void 0:P[o])&&e.jsxs("div",{children:[e.jsx($,{rows:P[o].list.map(re=>re.path),selectedId:D,setSelectedId:W}),D&&e.jsx("div",{children:(()=>{const re=P[o].list.find(fe=>fe.path===D);if(re)return e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:[e.jsx("b",{children:"Цена:"})," ",re.price," "]}),e.jsxs("p",{children:[e.jsx("b",{children:"Формула:"})," ",re.tag," "]}),e.jsxs("p",{children:[e.jsx("b",{children:"Спред:"})," ",X(re.spread)," %"]}),e.jsxs("p",{children:[e.jsx("b",{children:"Разница с реф.ценой:"})," ",Y(re.price)," %"]})]})})()}),P[o].referentPrice&&e.jsxs("p",{children:[e.jsx("b",{children:"Реф. цена:"})," ",P[o].referentPrice," (",P[o].referentSource,")"]})]}),o==="CoinMarketCap"&&(P==null?void 0:P[o])&&e.jsxs("div",{children:[e.jsxs("p",{children:[e.jsx("b",{children:"Цена:"})," ",(z=P[o].list[0])==null?void 0:z.price," "]}),e.jsxs("p",{children:[e.jsx("b",{children:"Формула:"})," ",(U=P[o].list[0])==null?void 0:U.tag," "]})]}),o==="fromFile"&&(P==null?void 0:P[o])&&e.jsxs("div",{children:[e.jsxs("p",{children:[e.jsx("b",{children:"Цена:"})," ",(Z=P[o].list[0])==null?void 0:Z.price," "]}),e.jsxs("p",{children:[e.jsx("b",{children:"Формула:"})," ",(ce=P[o].list[0])==null?void 0:ce.tag," "]})]}),o==="auto"&&e.jsxs("label",{children:["При ошибке:",e.jsx($,{rows:C,selectedId:I,setSelectedId:w})]}),o!=="auto"&&e.jsx("p",{children:"При ошибке: Отключить"}),e.jsx("div",{className:i.actionButtons,children:e.jsx("button",{onClick:K,className:i.save,children:"Сохранить"})})]})},K=async()=>{console.log(P);let z=Object.values(P).every(U=>U===null);if(z&&!F){A.warn("Формула не задана. Нажмите Найти для поиска");return}y(!0);try{let U=o!=="auto"?"off":I,Z={},ce;z?ce={...F,reserve:U}:(console.log("constructing new formula..."),o==="auto"?Z=P[o].list.find(fe=>fe.path===D):Z=P[o].list[0],ce={from:_,to:f,tag:Z.tag,reserve:U,isEnabled:!0});let re=await p({formula:ce});A.info(re.message)}finally{y(!1)}},X=z=>(Math.abs(z)<.01?z=z.toFixed(6):z=z.toFixed(2),z),Y=z=>{let U=Math.max(P[o].referentPrice,z),Z=Math.min(P[o].referentPrice,z),ce=(U-Z)/Z*100;return X(ce)};if(k||h||T||a)return e.jsx("p",{children:"Загрузка..."});if(E)return e.jsx("p",{children:"Сохранение..."});const x=n.isEditCurrency?"Редактировать":"Просмотреть";return e.jsxs(e.Fragment,{children:[t?e.jsxs("h2",{children:[x," формулу"]}):e.jsx("h2",{children:"Добавить формулу"}),t&&F&&e.jsxs(e.Fragment,{children:[e.jsx("h3",{children:"Старая формула"}),e.jsx("p",{children:F.tag}),e.jsxs("p",{children:[e.jsx("b",{children:"Отдаю:"})," ",F.from]}),e.jsxs("p",{children:[e.jsx("b",{children:"Получаю:"})," ",F.to]}),e.jsxs("p",{children:[e.jsx("b",{children:"Курс:"})," ",F.price]}),e.jsxs("p",{children:[e.jsx("b",{children:"Обратный курс:"})," ",F.price?1/F.price:0]}),e.jsxs("p",{children:[e.jsx("b",{children:"При ошибке:"})," ",C.find(z=>z.id==F.reserve).name]}),e.jsxs("label",{children:[e.jsx("input",{style:{marginLeft:"0"},type:"checkbox",checked:F.isEnabled,onChange:z=>L(U=>({...U,isEnabled:z.target.checked}))}),"Включена"]})]}),!t&&e.jsxs("div",{children:[e.jsxs("label",{children:["Отдаю:",e.jsx($,{rows:l,selectedId:_,setSelectedId:S})]}),e.jsxs("label",{children:["Получаю:",e.jsx($,{rows:l,selectedId:f,setSelectedId:v})]})]}),n.isEditCurrency&&e.jsx(q,{})]})}const sa=Object.freeze(Object.defineProperty({__proto__:null,default:on},Symbol.toStringTag,{value:"Module"})),dn=({data:t,rowsSelected:n,setRowsSelected:a,activeRole:c})=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:i.checkboxContainer,children:[e.jsx("input",{type:"checkbox",id:t.id,checked:n.includes(t.id),onChange:()=>{n.includes(t.id)?a(n.filter(r=>r!==t.id)):a([...n,t.id])}}),e.jsxs("span",{children:[e.jsx("label",{htmlFor:t.name,children:t.name}),e.jsx("p",{className:i.links,children:e.jsx(ie,{to:`${M.EDIT_ORDER_STATUS}/${t.id}`,children:c!=null&&c.isEditDirection?"Редактировать..":"Просмотреть.."})})]})]}),e.jsx("div",{children:t.id}),e.jsx("div",{children:new Date(t.lastUpdated).toLocaleString()})]}),un=({data:t,rowsSelected:n,setRowsSelected:a})=>{const{activeRole:c}=s.useContext(Q);return e.jsxs("div",{className:i.tableThreeCol,children:[e.jsx("div",{children:"Название"}),e.jsx("div",{children:"ID"}),e.jsx("div",{children:"Обновлено"}),t.map((r,u)=>e.jsx(dn,{data:r,rowsSelected:n,setRowsSelected:a,activeRole:c},u))]})};function hn(){const{fetchOrderStatuses:t,deleteOrderStatuses:n}=s.useContext(V),{activeRole:a,loading:c}=s.useContext(Q),[r,u]=s.useState(),[h,l]=s.useState([]),[j,p]=s.useState(!0),[b,d]=s.useState(!1),C=J();s.useEffect(()=>{(async()=>{p(!0);try{let w=await t();u(w.data)}finally{p(!1)}})()},[]);const o=async()=>{try{d(!0);const I=await n({ids:h});u([...r.filter(w=>!h.includes(w.id))]),l([]),A.info(I.message)}finally{d(!1)}},m=()=>e.jsxs("div",{className:i.actionButtons,children:[e.jsxs("p",{children:["Выбрано ",h.length," элементов."]}),e.jsx("button",{onClick:o,children:"Удалить"})]});return c||j?e.jsx("p",{children:"Загрузка..."}):b?e.jsx("p",{children:"Удаление..."}):e.jsxs(e.Fragment,{children:[e.jsx("h2",{children:"Статусы заявок"}),a.isEditDirection&&e.jsx("button",{className:i.addButton,onClick:()=>{C(M.EDIT_ORDER_STATUS)},children:"Добавить.."}),e.jsx(un,{data:r,rowsSelected:h,setRowsSelected:l}),h.length>0&&a.isEditDirection&&e.jsx(m,{rowsSelected:h})]})}const na=Object.freeze(Object.defineProperty({__proto__:null,default:hn},Symbol.toStringTag,{value:"Module"}));function xn(){const{currencies:t,loading:n}=s.useContext(se),{fetchOrderStatus:a}=s.useContext(he),{sendOrderStatus:c}=s.useContext(V),{activeRole:r,loading:u}=s.useContext(Q),[h,l]=s.useState([]),[j,p]=s.useState([]),[b,d]=s.useState("popup"),C=[{id:"popup",name:"Всплывающее окно"},{id:"deadlines",name:"Сроки выполнения"},{id:"instructions",name:"Инструкции по обмену"},{id:"new",name:"Новая"},{id:"waitingForPayment",name:"Ожидание оплаты"},{id:"waitingForConfirmation",name:"Ждем подтверждения оплаты"},{id:"payed",name:"Оплачено"},{id:"waitingForPayout",name:"Ждем подтверждения выплаты"},{id:"onCheck",name:"На проверке"},{id:"completed",name:"Выполнено"},{id:"cancelled",name:"Отмена"},{id:"error",name:"Ошибка"},{id:"deleted",name:"Удаленная"}],[o,m]=s.useState({name:"",list:C}),[I,w]=s.useState(""),{id:_}=le(),[S,f]=s.useState(!1),[v,k]=s.useState(!1);s.useEffect(()=>{_&&(async()=>{var F,L;f(!0);let R=(await a({id:_})).data;m({...R,list:R.list.map(P=>({id:P.statusType,name:C.find(g=>g.id===P.statusType).name,text:P.text}))}),l(R.idsFrom),p(R.idsTo),d("popup"),w(((L=(F=R.list)==null?void 0:F.find(P=>P.statusType==="popup"))==null?void 0:L.text)||""),f(!1)})()},[_]),s.useEffect(()=>{var R;const T=(R=o==null?void 0:o.list)==null?void 0:R.find(F=>F.id===b);w((T==null?void 0:T.text)||"")},[b]);const N=T=>{const{name:R,type:F,checked:L,value:P}=T.target;m(g=>({...g,[R]:F==="checkbox"?L:P}))},E=T=>{w(T.target.value),m(R=>({...R,list:R.list.map(F=>F.id===b?{...F,text:T.target.value}:F)}))},y=async()=>{try{k(!0);let T={...o,list:o.list.map(F=>({statusType:F.id,text:F.text||""}))};T.idsFrom=h,T.idsTo=j;const R=await c({orderStatus:T});A.info(R.message)}finally{k(!1)}};return n||u||S?e.jsx("p",{children:"Загрузка..."}):v?e.jsx("p",{children:"Сохранение..."}):e.jsxs(e.Fragment,{children:[e.jsxs("h2",{children:[r.isEditDirection?_?"Редактировать":"Создать":"Просмотреть"," группу статусов"]}),e.jsx("div",{children:e.jsxs("label",{children:["Название:",e.jsx("input",{name:"name",value:o==null?void 0:o.name,onChange:N})]})}),e.jsxs("label",{children:["Статус заявки: ",e.jsx($,{rows:o==null?void 0:o.list,selectedId:b,setSelectedId:d})]}),e.jsx("textarea",{rows:"10",cols:"40",value:I,onChange:E,style:{width:"100%"}}),e.jsx("div",{children:"Применить для валют:"}),e.jsxs("div",{className:i.tableTwoColLayout,children:[e.jsxs("div",{children:[e.jsx("h4",{style:{marginTop:"0"},children:"Отдаю:"}),e.jsx(ae,{rows:t.map(T=>({id:T.id,name:`${T.name} (${T.code})`})),checkedKeys:h,onCheckChange:l,className:i.checkboxList}),e.jsx(ue,{items:t,rowsSelected:h,setRowsSelected:l})]}),e.jsxs("div",{children:[e.jsx("h4",{style:{marginTop:"0"},children:"Получаю:"}),e.jsx(ae,{rows:t.map(T=>({id:T.id,name:`${T.name} (${T.code})`})),checkedKeys:j,onCheckChange:p,className:i.checkboxList}),e.jsx(ue,{items:t,rowsSelected:j,setRowsSelected:p})]})]}),r.isEditDirection&&e.jsx("button",{className:i.save,onClick:y,children:"Сохранить"})]})}const aa=Object.freeze(Object.defineProperty({__proto__:null,default:xn},Symbol.toStringTag,{value:"Module"}));function jn(){const{fetchStopWords:t,sendStopWords:n}=s.useContext(V),[a,c]=s.useState(!0),[r,u]=s.useState(!1),[h,l]=s.useState(),j=async()=>{try{c(!0);let b=(await t()).data;l(b?b.join(`
`):"")}finally{c(!1)}},p=async()=>{try{u(!0);const b=h.split(`
`).map(C=>C.trim()).filter(C=>C!==""),d=await n({words:b});A.info(d.message)}finally{u(!1)}};return s.useEffect(()=>{j()},[]),a?e.jsx("p",{children:"Загрузка..."}):r?e.jsx("p",{children:"Сохранение..."}):e.jsxs(e.Fragment,{children:[e.jsx("h3",{children:"Стоп-слова (с новой строки):"}),e.jsx("textarea",{rows:"10",cols:"40",value:h,style:{width:"100%"},onChange:b=>l(b.target.value)}),e.jsx("button",{className:i.save,style:{marginTop:"2em"},onClick:p,children:"Сохранить"})]})}const ia=Object.freeze(Object.defineProperty({__proto__:null,default:jn},Symbol.toStringTag,{value:"Module"})),mn=({data:t})=>e.jsxs(e.Fragment,{children:[e.jsx("div",{children:new Date(t.dateCreated).toLocaleString()}),e.jsxs("div",{children:[t.userName," | ",t.userMail]}),e.jsx("div",{children:t.orderId}),e.jsx("div",{children:t.orderValue.toFixed(2)}),e.jsx("div",{children:t.profit.toFixed(2)}),e.jsx("div",{children:t.earnings.toFixed(2)})]}),fn=({data:t})=>t.length==0?e.jsx("div",{children:"Нет данных"}):e.jsxs("div",{className:i.tableSixCol,children:[e.jsx("div",{children:"Дата"}),e.jsx("div",{children:"Пользователь | почта"}),e.jsx("div",{children:"ID заявки"}),e.jsx("div",{children:"Сумма, USDT"}),e.jsx("div",{children:"Прибыль"}),e.jsx("div",{children:"Бонус"}),t.map((n,a)=>e.jsx(mn,{data:n},a))]});function gn(){const[t,n]=s.useState(!0),[a,c]=s.useState(0),[r,u]=s.useState(),h=10,[l,j]=s.useState(0),[p,b]=s.useState(),[d,C]=s.useState(),[o,m]=s.useState(),{fetchCashbackOrders:I}=s.useContext(V),[w,_]=s.useState(!1);async function S(){try{n(!0);const v=l*h;let k=(await I({start:v,count:h,userMail:p,dateStart:d==null?void 0:d.concat("T00:00"),dateEnd:o==null?void 0:o.concat("T00:00")})).data;u(k.items),c(k.total)}finally{n(!1)}}function f(){l==0?S():j(0)}return s.useEffect(()=>{S()},[l]),t?e.jsx("p",{children:"Загрузка..."}):e.jsxs(e.Fragment,{children:[e.jsx("h2",{children:"Заявки с бонусами"}),e.jsx(me,{title:"Фильтр",isVisible:w,setIsVisible:_,styles:i,child:e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginBottom:"1em"},children:[e.jsxs("label",{children:["Дата от: ",e.jsx("input",{type:"date",value:d,name:"dateStart",onChange:v=>C(v.target.value)})]}),e.jsxs("label",{children:["Дата до: ",e.jsx("input",{type:"date",value:o,name:"dateEnd",onChange:v=>m(v.target.value)})]})]}),e.jsx("div",{style:{marginBottom:"1em"},children:e.jsxs("label",{children:["Почта пользователя: ",e.jsx("input",{type:"text",value:p,name:"email",onChange:v=>b(v.target.value)})]})}),e.jsx("button",{onClick:f,children:"Применить"})]})}),e.jsx(H,{total:a,currentPage:l,rowsPerPage:h,onPageChange:j,styles:i}),e.jsx(fn,{data:r}),e.jsx(H,{total:a,currentPage:l,rowsPerPage:h,onPageChange:j,styles:i})]})}const la=Object.freeze(Object.defineProperty({__proto__:null,default:gn},Symbol.toStringTag,{value:"Module"})),pn=({data:t})=>e.jsxs(e.Fragment,{children:[e.jsx("div",{children:new Date(t.dateCreated).toLocaleString()}),e.jsxs("div",{children:[t.userName," | ",t.userMail]}),e.jsx("div",{children:t.orderId}),e.jsx("div",{children:t.orderValue.toFixed(2)}),e.jsx("div",{children:t.profit.toFixed(2)}),e.jsxs("div",{children:[t.refName," | ",t.refMail]}),e.jsx("div",{children:t.earnings.toFixed(2)})]}),Cn=({data:t})=>t.length==0?e.jsx("div",{children:"Нет данных"}):e.jsxs("div",{className:i.tableSevenCol,children:[e.jsx("div",{children:"Дата"}),e.jsx("div",{children:"Пользов. | почта"}),e.jsx("div",{children:"ID заявки"}),e.jsx("div",{children:"Сумма, USDT"}),e.jsx("div",{children:"Прибыль"}),e.jsx("div",{children:"Партнер | почта"}),e.jsx("div",{children:"Партнер заработал"}),t.map((n,a)=>e.jsx(pn,{data:n},a))]});function vn(){const[t,n]=s.useState(!0),[a,c]=s.useState(0),[r,u]=s.useState(),h=10,[l,j]=s.useState(0),[p,b]=s.useState(),[d,C]=s.useState(),[o,m]=s.useState(),{fetchReferralsOrders:I}=s.useContext(V),[w,_]=s.useState(!1);async function S(){try{n(!0);const v=l*h;let k=await I({start:v,count:h,refMail:p,dateStart:d==null?void 0:d.concat("T00:00"),dateEnd:o==null?void 0:o.concat("T00:00")}).then(N=>N.data);u(k.items),c(k.total)}finally{n(!1)}}function f(){l==0?S():j(0)}return s.useEffect(()=>{S()},[l]),t?e.jsx("p",{children:"Загрузка..."}):e.jsxs(e.Fragment,{children:[e.jsx("h2",{children:"Реферальные заявки"}),e.jsx(me,{title:"Фильтр",isVisible:w,setIsVisible:_,styles:i,child:e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginBottom:"1em"},children:[e.jsxs("label",{children:["Дата от: ",e.jsx("input",{type:"date",value:d,name:"dateStart",onChange:v=>C(v.target.value)})]}),e.jsxs("label",{children:["Дата до: ",e.jsx("input",{type:"date",value:o,name:"dateEnd",onChange:v=>m(v.target.value)})]})]}),e.jsx("div",{style:{marginBottom:"1em"},children:e.jsxs("label",{children:["Почта реферала: ",e.jsx("input",{type:"text",value:p,name:"email",onChange:v=>b(v.target.value)})]})}),e.jsx("button",{onClick:f,children:"Применить"})]})}),e.jsx(H,{total:a,currentPage:l,rowsPerPage:h,onPageChange:j,styles:i}),e.jsx(Cn,{data:r}),e.jsx(H,{total:a,currentPage:l,rowsPerPage:h,onPageChange:j,styles:i})]})}const ra=Object.freeze(Object.defineProperty({__proto__:null,default:vn},Symbol.toStringTag,{value:"Module"}));export{ra as A,On as B,_n as C,Fn as D,Tn as E,ta as F,Zn as G,Sn as M,Mn as N,In as O,Gn as R,ia as S,Bn as U,oe as W,wn as a,Nn as b,En as c,kn as d,Rn as e,Ln as f,Pn as g,Un as h,Dn as i,$n as j,An as k,zn as l,Vn as m,Wn as n,Kn as o,Yn as p,Qn as q,Xn as r,Hn as s,Jn as t,qn as u,ea as v,sa as w,na as x,aa as y,la as z};
